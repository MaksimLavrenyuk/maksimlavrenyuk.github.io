!function(){function e(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}window.require="function"==typeof require?function(e,t){var r=t.querySelector("script[data-main]");return r&&e(r.dataset.main),e}(require,document):function(e){var t=/,[ ]*/gim;function r(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t}return function(){var n={},i=function(){var r,n=e.head,i=e.querySelector("script[data-scripts]"),o=e.querySelector("script[data-styles]"),s=o?o.dataset.styles:"",a=i?i.dataset.scripts:"",c=e.querySelector("script[data-base_dir]"),u=c&&c.dataset.base_dir;return u=u&&"string"==typeof u?u:"./",(u=new URL(u,location.href).href)&&((r=e.createElement("base")).setAttribute("href",u),n.append(r)),"string"==typeof s&&s.trim().replace(t,",").split(",").forEach((function(t){(r=e.createElement("link")).setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",t.trim()),n.append(r)})),"string"==typeof a&&a.trim().replace(t,",").split(",").forEach((function(t){(r=e.createElement("script")).setAttribute("type","text/javascript"),r.setAttribute("src",t.trim()),n.append(r)})),u}(),o=e.querySelector("script[data-main]"),s=o?o.dataset.main:null;function a(e,t){t="string"==typeof t?t.trim():"";var i=new URL(t,e);i.pathname=function(e){if((e="string"==typeof e?e:"").indexOf(".")<0){var t=r("".concat(e,"/package.json"));200===t.status&&(e=e+"/"+JSON.parse(t.responseText).main)}return e}(i.pathname),e=i.href.substr(0,i.href.lastIndexOf("/")+1);var o=i.pathname.substr(i.pathname.lastIndexOf("/")+1);if(n.hasOwnProperty(i.href))return n[i.href];var s=r(i.href);if(200===s.status){var c={};return/(.json)$/gi.test(o)?c.exports=JSON.parse(s.responseText):(c.exports={},new Function("exports","require","module","__filename","__dirname","\n              ".concat(s.responseText,"\n              //# sourceURL=").concat(i.href,"\n            ")).call(this,c.exports,a.bind(this,e),c,o,e),n[i.href]=c.exports),c.exports}}Object.defineProperty(a,"modules",{set:Function.prototype,get:function(){return n}});var c=a.bind(this,i);return s&&window.addEventListener("load",c.bind(this,new URL(s,i).href)),c}()}(document);var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};function r(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var n=function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function o(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function c(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var u,l=function(){function e(){this.listeners=null}return e.prototype.getListenerHandle=function(e,t){var r=this;if(this.listeners)for(var n=function(n){if(i.listeners[e][n]===t)return{value:{deregister:function(){return!!r.listeners&&(r.listeners[e].splice(n,1),!0)}}}},i=this,o=0;o<this.listeners[e].length;o++){var s=n(o);if("object"==typeof s)return s.value}},e.prototype.registerListener=function(e,t){var r,n=this;return null!==this.listeners?this.listeners[e]?this.listeners[e].push(t):this.listeners[e]=[t]:this.listeners=((r={})[e]=[t],r),{deregister:function(){if(n.listeners&&n.listeners[e])for(var r=0;r<n.listeners[e].length;r++)if(n.listeners[e][r]===t)return n.listeners[e].splice(r,1),!0;return!1}}},e.prototype.deregisterListener=function(e,t){var r=this.getListenerHandle(e,t);return!!r&&r.deregister()},e.prototype.emit=function(e,t){var r=this.listeners;r&&Object.keys(r).forEach((function(n){n===e&&r[e]&&r[e].forEach((function(e){e(t)}))}))},e}();!function(e){e.connect="connect",e.disconnect="disconnect",e.init="init",e.act="act",e.ping="ping"}(u||(u={}));var h=function(){function e(e){this.isDebug="debug"===e.mode,this.connectState={loading:!1,error:!1},this.pingState=[],this.actAccumulator=[],this.actListener=this.actListener.bind(this),this.actManager=e.manager,this.variableStorage=e.variableStorage,this.events=new l}return e.createDebugMsgInit=function(){return{type:u.init}},e.createDebugMsgPing=function(){return{type:u.ping}},e.createDebugMsgDisconnect=function(){return{type:u.disconnect}},e.isPingMsg=function(e){return e.type===u.ping},e.isDisconnectMsg=function(e){return e.type===u.disconnect},e.isConnectMsg=function(e){return e.type===u.connect},e.prototype.start=function(){this.isDebug&&(this.spy(),this.connect())},e.prototype.emitInit=function(){this.events.emit("msg",e.createDebugMsgInit())},e.prototype.emitPing=function(){this.events.emit("msg",e.createDebugMsgPing())},e.prototype.emitDisconnect=function(){this.events.emit("msg",e.createDebugMsgDisconnect())},e.prototype.emitAction=function(e){this.events.emit("msg",this.createDebugMsgAct(e))},e.prototype.createDebugMsgAct=function(e){return{type:u.act,data:{act:e,variables:this.variableStorage.readVariables()}}},e.prototype.setConnectState=function(e){this.connectState=n(n({},this.connectState),e)},e.prototype.addPing=function(e){this.pingState.push(e)},e.prototype.checkPing=function(){if(this.pingState.length<e.PING_CHECK_SIZE)return!0;for(var t=this.pingState.length-1;t>this.pingState.length-1-e.PING_CHECK_SIZE;t--){var r=this.pingState[t];if(null!==r&&!r.error)return!0}return!1},e.prototype.actListener=function(e){this.connectState.loading?this.actAccumulator.push(e):this.emitAction(e)},e.prototype.cleanActAccumulator=function(){var e=this;this.actAccumulator.forEach((function(t){e.emitAction(t)})),this.actAccumulator.length=0},e.prototype.spy=function(){this.actManager.events.registerListener("act",this.actListener)},e.prototype.spyPing=function(){var t=this,r=0,n=setInterval((function(){t.emitPing(),r+=1,setTimeout((function(){void 0===t.pingState[r-1]&&t.addPing(null),t.checkPing()||(clearInterval(n),t.disconnect())}),e.PING_CHECK_TIME)}),e.PING_INTERVAL)},e.prototype.pingListener=function(){this.addPing({error:!1})},e.prototype.message=function(t){e.isConnectMsg(t)?(this.setConnectState({loading:!1}),this.cleanActAccumulator(),this.spyPing()):e.isPingMsg(t)?this.pingListener():e.isDisconnectMsg(t)&&this.disconnect()},e.prototype.disconnect=function(){this.setConnectState({loading:!1,error:!0}),this.emitDisconnect()},e.prototype.connect=function(){var t=this;this.setConnectState({loading:!0}),this.emitInit(),setTimeout((function(){t.connectState.loading&&t.disconnect()}),e.CONNECT_TIMEOUT)},e.PING_INTERVAL=5e3,e.PING_CHECK_TIME=1e3,e.PING_CHECK_SIZE=5,e.CONNECT_TIMEOUT=1e4,e}(),f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function p(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}var d=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},m=Object.prototype.hasOwnProperty;function g(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function v(e){try{return encodeURIComponent(e)}catch(e){return null}}var y={stringify:function(e,t){t=t||"";var r,n,i=[];for(n in"string"!=typeof t&&(t="?"),e)if(m.call(e,n)){if((r=e[n])||null!=r&&!isNaN(r)||(r=""),n=v(n),r=v(r),null===n||null===r)continue;i.push(n+"="+r)}return i.length?t+i.join("&"):""},parse:function(e){for(var t,r=/([^=?#&]+)=?([^&]*)/g,n={};t=r.exec(e);){var i=g(t[1]),o=g(t[2]);null===i||null===o||i in n||(n[i]=o)}return n}},w=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,b=/[\n\r\t]/g,S=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,E=/:\d+$/,I=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,C=/^[a-zA-Z]:/;function T(e){return(e||"").toString().replace(w,"")}var L=[["#","hash"],["?","query"],function(e,t){return x(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],k={hash:1,query:1};function R(e){var t,r=("undefined"!=typeof window?window:void 0!==f?f:"undefined"!=typeof self?self:{}).location||{},n={},i=typeof(e=e||r);if("blob:"===e.protocol)n=new D(unescape(e.pathname),{});else if("string"===i)for(t in n=new D(e,{}),k)delete n[t];else if("object"===i){for(t in e)t in k||(n[t]=e[t]);void 0===n.slashes&&(n.slashes=S.test(e.href))}return n}function x(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function _(e,t){e=(e=T(e)).replace(b,""),t=t||{};var r,n=I.exec(e),i=n[1]?n[1].toLowerCase():"",o=!!n[2],s=!!n[3],a=0;return o?s?(r=n[2]+n[3]+n[4],a=n[2].length+n[3].length):(r=n[2]+n[4],a=n[2].length):s?(r=n[3]+n[4],a=n[3].length):r=n[4],"file:"===i?a>=2&&(r=r.slice(2)):x(i)?r=n[4]:i?o&&(r=r.slice(2)):a>=2&&x(t.protocol)&&(r=n[4]),{protocol:i,slashes:o||x(i),slashesCount:a,rest:r}}function D(e,t,r){if(e=(e=T(e)).replace(b,""),!(this instanceof D))return new D(e,t,r);var n,i,o,s,a,c,u=L.slice(),l=typeof t,h=this,f=0;for("object"!==l&&"string"!==l&&(r=t,t=null),r&&"function"!=typeof r&&(r=y.parse),n=!(i=_(e||"",t=R(t))).protocol&&!i.slashes,h.slashes=i.slashes||n&&t.slashes,h.protocol=i.protocol||t.protocol||"",e=i.rest,("file:"===i.protocol&&(2!==i.slashesCount||C.test(e))||!i.slashes&&(i.protocol||i.slashesCount<2||!x(h.protocol)))&&(u[3]=[/(.*)/,"pathname"]);f<u.length;f++)"function"!=typeof(s=u[f])?(o=s[0],c=s[1],o!=o?h[c]=e:"string"==typeof o?~(a="@"===o?e.lastIndexOf(o):e.indexOf(o))&&("number"==typeof s[2]?(h[c]=e.slice(0,a),e=e.slice(a+s[2])):(h[c]=e.slice(a),e=e.slice(0,a))):(a=o.exec(e))&&(h[c]=a[1],e=e.slice(0,a.index)),h[c]=h[c]||n&&s[3]&&t[c]||"",s[4]&&(h[c]=h[c].toLowerCase())):e=s(e,h);r&&(h.query=r(h.query)),n&&t.slashes&&"/"!==h.pathname.charAt(0)&&(""!==h.pathname||""!==t.pathname)&&(h.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,i=r[n-1],o=!1,s=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),s++):s&&(0===n&&(o=!0),r.splice(n,1),s--);return o&&r.unshift(""),"."!==i&&".."!==i||r.push(""),r.join("/")}(h.pathname,t.pathname)),"/"!==h.pathname.charAt(0)&&x(h.protocol)&&(h.pathname="/"+h.pathname),d(h.port,h.protocol)||(h.host=h.hostname,h.port=""),h.username=h.password="",h.auth&&(~(a=h.auth.indexOf(":"))?(h.username=h.auth.slice(0,a),h.username=encodeURIComponent(decodeURIComponent(h.username)),h.password=h.auth.slice(a+1),h.password=encodeURIComponent(decodeURIComponent(h.password))):h.username=encodeURIComponent(decodeURIComponent(h.auth)),h.auth=h.password?h.username+":"+h.password:h.username),h.origin="file:"!==h.protocol&&x(h.protocol)&&h.host?h.protocol+"//"+h.host:"null",h.href=h.toString()}D.prototype={set:function(e,t,r){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||y.parse)(t)),n[e]=t;break;case"port":n[e]=t,d(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,E.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var i="pathname"===e?"/":"#";n[e]=t.charAt(0)!==i?i+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(n.username=t.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var s=0;s<L.length;s++){var a=L[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin="file:"!==n.protocol&&x(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=y.stringify);var t,r=this,n=r.host,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var o=i+(r.protocol&&r.slashes||x(r.protocol)?"//":"");return r.username?(o+=r.username,r.password&&(o+=":"+r.password),o+="@"):r.password?(o+=":"+r.password,o+="@"):"file:"!==r.protocol&&x(r.protocol)&&!n&&"/"!==r.pathname&&(o+="@"),(":"===n[n.length-1]||E.test(r.hostname)&&!r.port)&&(n+=":"),o+=n+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(o+=r.hash),o}},D.extractProtocol=_,D.location=R,D.trimLeft=T,D.qs=y;var P=D,H="actm-";var q,U,A,F="Function.prototype.bind called on incompatible ",O=Array.prototype.slice,M=Object.prototype.toString,N="[object Function]",j=Function.prototype.bind||function(e){var t=this;if("function"!=typeof t||M.call(t)!==N)throw new TypeError(F+t);for(var r,n=O.call(arguments,1),i=function(){if(this instanceof r){var i=t.apply(this,n.concat(O.call(arguments)));return Object(i)===i?i:this}return t.apply(e,n.concat(O.call(arguments)))},o=Math.max(0,t.length-n.length),s=[],a=0;a<o;a++)s.push("$"+a);if(r=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var c=function(){};c.prototype=t.prototype,r.prototype=new c,c.prototype=null}return r},V=j.call(Function.call,Object.prototype.hasOwnProperty),W=0,z=function(){function e(e,t){this.strId=e.strId,this.firingOption=e.firingOption,this.priority=e.priority||W,this.period=e.period,this.before=e.before,this.after=e.after,this.triggers=e.triggers,this.tag=e.tag,this.deps=t}return e.sortInstructionsByPriority=function(e){for(var t=c([],a(e),!1),r=1;r<t.length;r++){for(var n=t[r],i=r-1;i>-1&&t[i].priority<n.priority;)t[i+1]=t[i],i-=1;t[i+1]=n}return t},e.prototype.checkPeriod=function(){if(void 0===this.period)return!0;if(this.period){var e=Number(new Date(this.period.start)),t=Number(new Date(this.period.end)),r=Number(new Date);return e<=r&&r<=t}return!1},e.prototype.act=function(e){return!!e||this.checkPeriod()},e.prototype.run=function(e){return o(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:return(t=this.act(e))?[4,null==(r=this.deps.tagStorage.tag(this.tag))?void 0:r.run()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2,t]}}))}))},e}(),B=function(){function e(e){this.instructionStorage=e.deps.instructionStorage}return e.prototype.visit=function(e,t,r){return o(this,void 0,void 0,(function(){var n,i;return s(this,(function(o){switch(o.label){case 0:return void 0===e?[2]:((null==e?void 0:e.before)&&(n=this.instructionStorage.instruction(e.before)),(null==e?void 0:e.after)&&(i=this.instructionStorage.instruction(e.after)),[4,this.visit(n,t,r)]);case 1:return o.sent(),[4,r(e,e===t)];case 2:return o.sent(),[4,this.visit(i,t,r)];case 3:return o.sent(),[2]}}))}))},e.prototype.walk=function(e,t){return o(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.visit(e,e,t)];case 1:return r.sent(),[2]}}))}))},e}();function G(e){return Object.keys(e)}function J(e,t){return"object"==typeof e&&null!==e&&V(e,t)}!function(e){e.Click="click",e.ClickLink="click_link",e.GroupTrigger="group_trigger",e.Custom="custom",e.ViewPage="view_page",e.DomReady="dom_ready",e.DomElementVisible="dom_element_visible",e.Initialization="initialization",e.WindowLoaded="window_loaded",e.ScrollingDepth="scrolling_depth",e.SubmitForm="submit_form",e.ChangeHistory="change_history",e.JSError="js_error",e.Timer="timer"}(q||(q={})),function(e){e.oncePerEvent="once_per_event",e.oncePerPage="once_per_page",e.noRestrictions="no_restrictions"}(U||(U={})),function(e){e.equals="equals",e.notEquals="not_equals",e.contains="contains",e.notContains="not_contains",e.startsWith="starts_with",e.notStartsWith="not_starts_with",e.endsWith="ends_with",e.notEndsWith="not_ends_with",e.matchCssSelector="match_css_selector",e.notMatchCssSelector="not_match_css_selector",e.less="less",e.lessOrEquals="less_or_equals",e.greater="greater",e.greaterOrEquals="greater_or_equals"}(A||(A={}));var $,K=function(e){this.event=e.event};function Z(e){return"".concat(H).concat(e)}!function(e){e.DomElement="domElement",e.CustomVariable="customVariable",e.URL="Url",e.URLReferrer="UrlReferrer",e.JSVariable="JSVariable",e.JSCode="JSCode",e.Cookie="Cookie",e.ElementVisible="ElementVisible",e.Utm="Utm",e.Source="Source"}($||($={}));var Y,Q=$;!function(e){e.visibleRatio="visibleRatio",e.visibleTime="visibleTime",e.newUrl="newUrl",e.oldUrl="oldUrl",e.newUrlFragment="newUrlFragment",e.oldUrlFragment="oldUrlFragment",e.historyChangeSource="historyChangeSource",e.elementId="elementId",e.elementClasses="elementClasses",e.element="element",e.elementTarget="elementTarget",e.elementUrl="elementUrl",e.elementText="elementText",e.errorMessage="errorMessage",e.formId="formId",e.formClasses="formClasses",e.formElement="formElement",e.formTarget="formTarget",e.formUrl="formUrl",e.formText="formText",e.errorUrl="errorUrl",e.errorLine="errorLine",e.scrollThreshold="scrollThreshold",e.scrollUnits="scrollUnits",e.scrollDirection="scrollDirection",e.timerCurrentTime="timerCurrentTime",e.timerElapsedTime="timerElapsedTime",e.timerEventNumber="timerEventNumber",e.timerInterval="timerInterval",e.timerLimit="timerLimit",e.timerStartTime="timerStartTime",e.timerEventName="timerEventName",e.start="start"}(Y||(Y={}));var X=function(){function e(e){this.data=[],this.events=new l,this.variableStorage=e.variableStorage}return e.isInputEvent=function(e){return Boolean(e.event)},e.isEvent=function(e){return Boolean(e.event)},e.isEventKey=function(e,t){return"event"===e&&"string"==typeof t},e.prototype.formattingInputItem=function(t){var r;return e.isInputEvent(t)?n(n({},t),((r={})[e.ID_FIELD]=this.getLastEventId()+1,r)):t},e.prototype.formattingEvent=function(t){var r;return n(n({},t),((r={})[e.ID_FIELD]=this.getLastEventId()+1,r))},e.prototype.addOutsideItem=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=[];r.forEach((function(r){var n=G(r),s=null;n.forEach((function(n){var a=r[n];if(e.isEventKey(n,a)&&null===s){r.event;var c=i(r,["event"]);s=new K({event:a}),G(c).forEach((function(e){s&&(s[e]=c[e])})),o.push(s)}else t.variableStorage.add(Q.CustomVariable,"".concat(n),a)})),t.pushInputItem(r)})),o.forEach((function(e){t.events.emit("outsideEvent",e)}))},e.prototype.pushInputItem=function(e){this.data.push(this.formattingInputItem(e)),this.events.emit("updateData",this.data[this.data.length-1])},e.prototype.pushInsideEvent=function(e){this.data.push(this.formattingEvent(e)),this.events.emit("updateData",this.data[this.data.length-1])},e.prototype.addInsideItem=function(e){this.pushInsideEvent(e)},e.prototype.getLastEventId=function(){for(var t=this.data.length-1;t>-1;t--){var r=this.data[t];if(r&&e.isEvent(r)&&e.isEvent(r))return r[e.ID_FIELD]}return 0},e.ID_FIELD=Z("eventId"),e}();var ee={id:function(e){return"#"+e},className:function(e){return"."+e},url:function(e){return'[href="'+e+'"]'},target:function(e){return'[target="'+e+'"]'}},te={id:function(e){return'[id*="'+e+'"]'},className:function(e){return'[class*="'+e+'"]'},url:function(e){return'[href*="'+e+'"]'},target:function(e){return'[target*="'+e+'"]'}},re={id:function(e){return'[id^="'+e+'"]'},className:function(e){return'[class^="'+e+'"]'},url:function(e){return'[href^="'+e+'"]'},target:function(e){return'[target^="'+e+'"]'}},ne={id:function(e){return'[id$="'+e+'"]'},className:function(e){return'[class$="'+e+'"]'},url:function(e){return'[href$="'+e+'"]'},target:function(e){return'[target$="'+e+'"]'}};function ie(e,t,r){return e.closest(ee[t](r))}function oe(e,t,r){return e.closest(te[t](r))}function se(e,t,r){return e.closest(re[t](r))}function ae(e,t,r){return e.closest(ne[t](r))}function ce(e,t){return e.closest(t)}function ue(e,t){return""!==t&&String(e).trim().includes(t)}function le(e,t){return""!==t&&!String(e).trim().includes(t)}function he(e,t){return""!==t&&new RegExp("^".concat(t)).test(String(e).trim())}function fe(e,t){return""!==t&&!new RegExp("^".concat(t)).test(String(e).trim())}function pe(e,t){return""!==t&&new RegExp("".concat(t,"$")).test(String(e).trim())}function de(e,t){return""!==t&&!new RegExp("".concat(t,"$")).test(String(e).trim())}var me={id:function(e,t){return e.id.trim()===t},className:function(e,t){return e.className===t},url:function(e,t){return e instanceof HTMLFormElement&&e.action===t},target:function(e,t){return e instanceof HTMLFormElement&&e.target===t}},ge={id:function(e,t){return ue(e.id,t)},className:function(e,t){return ue(e.className,t)},url:function(e,t){return e instanceof HTMLFormElement&&ue(e.action,t)},target:function(e,t){return e instanceof HTMLFormElement&&ue(e.target,t)}},ve={id:function(e,t){return he(e.id,t)},className:function(e,t){return he(e.className,t)},url:function(e,t){return e instanceof HTMLFormElement&&he(e.action,t)},target:function(e,t){return e instanceof HTMLFormElement&&he(e.target,t)}},ye={id:function(e,t){return pe(e.id,t)},className:function(e,t){return pe(e.className,t)},url:function(e,t){return e instanceof HTMLFormElement&&pe(e.action,t)},target:function(e,t){return e instanceof HTMLFormElement&&pe(e.target,t)}};function we(e,t,r){return me[t](e,r)}function be(e,t,r){return ge[t](e,r)}function Se(e,t,r){return ve[t](e,r)}function Ee(e,t,r){return ye[t](e,r)}function Ie(e,t){for(var r=document.querySelectorAll(t),n=0;n<r.length;n++)if(r[n]===e)return!0;return!1}function Ce(e,t){return e instanceof HTMLElement&&null!==e.textContent&&e.textContent.trim()===t}function Te(e,t){return e instanceof HTMLElement&&null!==e.textContent&&(""!==t&&e.textContent.trim().includes(t))}function Le(e,t){return e instanceof HTMLElement&&null!==e.textContent&&(""!==t&&new RegExp("^".concat(t)).test(e.textContent.trim()))}function ke(e,t){return e instanceof HTMLElement&&null!==e.textContent&&(""!==t&&new RegExp("".concat(t,"$")).test(e.textContent.trim()))}var Re=function(){function e(e,t){var r=this;this.check=function(e){return e?Array.isArray(e)?r.checkEvents(e):r.checkEvent(e):r.checkState()},this.segment=e,this.deps=t}return e.checkForm=function(e,t,r){var n=t[Y.formElement],i=null;switch(r){case Y.formClasses:i="className";break;case Y.formId:i="id";break;case Y.formTarget:i="target";break;case Y.formUrl:i="url"}if(n)if(i)switch(e.operator){case A.equals:return we(n,i,e.filter);case A.notEquals:return!we(n,i,e.filter);case A.contains:return be(n,i,e.filter);case A.notContains:return!be(n,i,e.filter);case A.startsWith:return Boolean(Se(n,i,e.filter));case A.notStartsWith:return!Se(n,i,e.filter);case A.endsWith:return Boolean(Ee(n,i,e.filter));case A.notEndsWith:return!Ee(n,i,e.filter);default:return!1}else switch(r){case Y.formText:switch(e.operator){case A.equals:return Boolean(Ce(n,e.filter));case A.notEquals:return!Ce(n,e.filter);case A.contains:return Boolean(Te(n,e.filter));case A.notContains:return!Te(n,e.filter);case A.startsWith:return Boolean(Le(n,e.filter));case A.notStartsWith:return!Le(n,e.filter);case A.endsWith:return Boolean(ke(n,e.filter));case A.notEndsWith:return!ke(n,e.filter);default:return!1}case Y.formElement:switch(e.operator){case A.matchCssSelector:return Ie(n,e.filter);case A.notMatchCssSelector:return!Ie(n,e.filter);default:return!1}default:return!1}return!1},e.checkElement=function(e,t,r){var n=t[Y.element],i=null;switch(r){case Y.elementClasses:i="className";break;case Y.elementId:i="id";break;case Y.elementTarget:i="target";break;case Y.elementUrl:i="url"}if(n)if(i)switch(e.operator){case A.equals:return Boolean(ie(n,i,e.filter));case A.notEquals:return!ie(n,i,e.filter);case A.contains:return Boolean(oe(n,i,e.filter));case A.notContains:return!oe(n,i,e.filter);case A.startsWith:return Boolean(se(n,i,e.filter));case A.notStartsWith:return!se(n,i,e.filter);case A.endsWith:return Boolean(ae(n,i,e.filter));case A.notEndsWith:return!ae(n,i,e.filter);case A.matchCssSelector:return Boolean(ce(n,e.filter));case A.notMatchCssSelector:return!ce(n,e.filter);default:return!1}else switch(r){case Y.elementText:switch(e.operator){case A.equals:return Boolean(Ce(n,e.filter));case A.notEquals:return!Ce(n,e.filter);case A.contains:return Boolean(Te(n,e.filter));case A.notContains:return!Te(n,e.filter);case A.startsWith:return Boolean(Le(n,e.filter));case A.notStartsWith:return!Le(n,e.filter);case A.endsWith:return Boolean(ke(n,e.filter));case A.notEndsWith:return!ke(n,e.filter);default:return!1}case Y.element:switch(e.operator){case A.matchCssSelector:return Ie(n,e.filter);case A.notMatchCssSelector:return!Ie(n,e.filter);default:return!1}default:return!1}return!1},e.checkVisibleElement=function(t,r){var n=r[Y.visibleRatio];switch(t.operator){case A.equals:return e.equals(n,t.filter);case A.notEquals:return e.notEquals(n,t.filter);case A.contains:return ue(n,t.filter);case A.notContains:return le(n,t.filter);case A.startsWith:return he(n,t.filter);case A.notStartsWith:return fe(n,t.filter);case A.endsWith:return pe(n,t.filter);case A.notEndsWith:return de(n,t.filter);case A.greater:case A.greaterOrEquals:case A.less:case A.lessOrEquals:return e.compare(t.filter,n,t.operator);default:return!1}},e.typeFilter=function(e){var t=e.trim();if(String(void 0)!==t)return String(null)===t?null:Number.isNaN(Number(t))?t:Number(t)},e.compare=function(t,r,n){var i=e.typeFilter(t);if(("string"==typeof r||"number"==typeof r)&&"number"==typeof i)switch(n){case A.greaterOrEquals:return r>=i;case A.greater:return r>i;case A.less:return r<i;case A.lessOrEquals:return r<=i;default:return!1}return!1},e.equals=function(t,r){return t===e.typeFilter(r)},e.notEquals=function(t,r){return t!==e.typeFilter(r)},e.checkScrollDirection=function(t,r){var n=r[Y.scrollDirection];switch(t.operator){case A.equals:return e.equals(n,t.filter);case A.notEquals:return e.notEquals(n,t.filter);default:return!1}},e.scrollScrollUnits=function(t,r){var n=r[Y.scrollUnits];switch(t.operator){case A.equals:return e.equals(n,t.filter);case A.notEquals:return e.notEquals(n,t.filter);default:return!1}},e.checkScrollThreshold=function(t,r){var n=r[Y.scrollThreshold];switch(t.operator){case A.equals:return e.equals(n,t.filter);case A.notEquals:return e.notEquals(n,t.filter);case A.contains:return ue(n,t.filter);case A.notContains:return le(n,t.filter);case A.startsWith:return he(n,t.filter);case A.notStartsWith:return fe(n,t.filter);case A.endsWith:return pe(n,t.filter);case A.notEndsWith:return de(n,t.filter);case A.greater:case A.greaterOrEquals:case A.less:case A.lessOrEquals:return e.compare(t.filter,n,t.operator);default:return!1}},e.checkUrl=function(t,r,n){var i=r[n];if(!(i instanceof Element))switch(t.operator){case A.equals:return e.equals(i,t.filter);case A.notEquals:return e.notEquals(i,t.filter);case A.contains:return ue(i,t.filter);case A.notContains:return le(i,t.filter);case A.startsWith:return he(i,t.filter);case A.notStartsWith:return fe(i,t.filter);case A.endsWith:return pe(i,t.filter);case A.notEndsWith:return de(i,t.filter);default:return!1}return!1},e.checkError=function(t,r,n){var i=r[n];if(!(i instanceof Element))switch(t.operator){case A.equals:return e.equals(i,t.filter);case A.notEquals:return e.notEquals(i,t.filter);case A.contains:return ue(i,t.filter);case A.notContains:return le(i,t.filter);case A.startsWith:return he(i,t.filter);case A.notStartsWith:return fe(i,t.filter);case A.endsWith:return pe(i,t.filter);case A.notEndsWith:return de(i,t.filter);default:return!1}return!1},e.prototype.checkVariable=function(t){var r,n=t.argument,i=this.deps.variableStorage.variable(n);if(!i)return!1;switch(r=i.read(),t.operator){case A.equals:return e.equals(r,t.filter);case A.notEquals:return e.notEquals(r,t.filter);case A.contains:return ue(r,t.filter);case A.notContains:return le(r,t.filter);case A.startsWith:return he(r,t.filter);case A.notStartsWith:return fe(r,t.filter);case A.endsWith:return pe(r,t.filter);case A.notEndsWith:return de(r,t.filter);case A.matchCssSelector:return r instanceof Element&&Boolean(ce(r,t.filter));case A.notMatchCssSelector:return r instanceof Element&&!ce(r,t.filter);case A.greater:case A.greaterOrEquals:case A.less:case A.lessOrEquals:return e.compare(t.filter,r,t.operator);default:return!1}},e.prototype.checkQuery=function(t,r){var n=t.argument,i=function(e){return Boolean(Object.values(Y).find((function(t){return t===e})))}(n);if(i&&function(e){return e.event.startsWith(H)}(r))switch(n){case Y.element:case Y.elementId:case Y.elementClasses:case Y.elementUrl:case Y.elementTarget:case Y.elementText:return e.checkElement(t,r,n);case Y.visibleRatio:return e.checkVisibleElement(t,r);case Y.scrollDirection:return e.checkScrollDirection(t,r);case Y.scrollUnits:return e.scrollScrollUnits(t,r);case Y.scrollThreshold:return e.checkScrollThreshold(t,r);case Y.formElement:case Y.formId:case Y.formClasses:case Y.formUrl:case Y.formTarget:case Y.formText:return e.checkForm(t,r,n);case Y.newUrl:case Y.oldUrl:case Y.newUrlFragment:case Y.oldUrlFragment:return e.checkUrl(t,r,n);case Y.errorUrl:case Y.errorLine:case Y.errorMessage:return e.checkError(t,r,n);default:return!1}return this.checkVariable(t)},e.prototype.checkState=function(){for(var e=!1,t=0;t<this.segment.queries.length;t++)if(!(e=this.checkVariable(this.segment.queries[t])))return e;return e},e.prototype.checkEvent=function(e){for(var t=!1,r=0;r<this.segment.queries.length;r++)if(!(t=this.checkQuery(this.segment.queries[r],e)))return t;return t},e.prototype.checkEvents=function(e){for(var t=!1,r=0;r<e.length;r++)if(t=this.checkEvent(e[r]))return t;return t},e}(),xe=function(){function e(e){this.deps=e}return e.prototype.create=function(e){return new Re(e,this.deps)},e}(),_e=function(e){function t(){var t=e.call(this)||this;return t.listeners=null,t}return r(t,e),t.prototype.emit=function(e,t){return o(this,void 0,void 0,(function(){var r,n,i,o;return s(this,(function(s){switch(s.label){case 0:if(!(r=this.listeners))return[3,6];n=Object.keys(r),i=0,s.label=1;case 1:if(!(i<n.length))return[3,6];if(n[i]!==e||!r[e])return[3,5];o=0,s.label=2;case 2:return o<r[e].length?[4,(0,r[e][o])(t)]:[3,5];case 3:s.sent(),s.label=4;case 4:return o++,[3,2];case 5:return i++,[3,1];case 6:return[2]}}))}))},t}(l),De=function(e){var t=this;this.registerListener=function(e,r){return t.events.registerListener(e,r)},this.deregisterListener=function(e,r){return t.events.deregisterListener(e,r)},this.segmentFactory=new xe({variableStorage:e.deps.variableStorage}),this.strId=e.strId,this.events=new _e,(null==e?void 0:e.segment)&&(this.segment=this.segmentFactory.create(e.segment))},Pe=function(){this.event=Z("triggerGroup")},He=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.GroupTrigger,r.triggerFinished=!1,r.registerEvokedChildren={},r.childListener=r.childListener.bind(r),t.children.forEach((function(e){r.registerEvokedChildren[e.strId]={wasCalled:!1}})),t.children.forEach((function(e){e.registerListener("complete",r.childListener)})),r}return r(t,e),t.prototype.checkAllTriggersHaveBeenCalled=function(){return!Object.values(this.registerEvokedChildren).find((function(e){return!e.wasCalled}))},t.prototype.reset=function(){Object.values(this.registerEvokedChildren).forEach((function(e){e.wasCalled=!1})),this.triggerFinished=!1},t.prototype.childListener=function(e){return o(this,void 0,void 0,(function(){var t;return s(this,(function(r){return this.registerEvokedChildren[e.trigger.strId].wasCalled||(this.registerEvokedChildren[e.trigger.strId].wasCalled=!0,this.registerEvokedChildren[e.trigger.strId].event=e.event),t=this.checkAllTriggersHaveBeenCalled(),!this.triggerFinished&&t&&this.handler(),[2]}))}))},t.prototype.handler=function(){var e=this,t=[],r=new Pe;if(this.triggerFinished=!0,Object.values(this.registerEvokedChildren).forEach((function(e){e.event&&(Array.isArray(e.event)?t.push.apply(t,c([],a(e.event),!1)):t.push(e.event))})),void 0===this.segment||this.segment.check(t)){var n=c([r],a(t),!1);this.events.emit("run",{trigger:this,event:n,complete:{wasRunning:!0,onRelatedActivitiesCompleted:function(){e.events.emit("complete",{trigger:e,event:c([r],a(t),!1)})}}})}return{wasRunning:!1}},t}(De),qe=function(e){this.event=Z("click"),this.elementId=e.elementId,this.elementClasses=e.elementClasses,this.element=e.element,this.elementTarget=e.elementTarget,this.elementUrl=e.elementUrl,this.elementText=e.elementText};Y.elementId,Y.elementClasses,Y.element,Y.elementTarget,Y.elementUrl,Y.elementText;var Ue=function(){this.event=Z("init")},Ae=function(){this.event=Z("viewPage")},Fe=function(){this.event=Z("domReady")},Oe=function(){this.event=Z("windowLoaded")};function Me(e,t,r){if(void 0===r||0==+r)return Math[e](t);var n=t.toString().split("e");return+((n=Math[e](+(n[0]+"e"+(n[1]?+n[1]-r:-r))).toString().split("e"))[0]+"e"+(n[1]?+n[1]+r:r))}var Ne=function(){function e(t){var r=this,n={root:document.body,rootMargin:"0px",threshold:e.prepareThreshold(t.threshold)},i=t.visibilityTimeRequired||0;this.visibilityTime=0,this.spyIntervalId=null,this.visibilityTimeIntervalId=null,this.observer=new IntersectionObserver((function(n){var o=a(n,1)[0];if(o.isIntersecting){var s=!1;if(0===i){if(!s){s=!0;var c=o.target.getAttribute("target"),u=o.target.getAttribute("href");t.cb({visibleTime:r.visibilityTime,visibleRatio:e.prepareIntersectionRatio(o.intersectionRatio),elementId:o.target.id,elementClasses:o.target.className,element:o.target,elementTarget:c||"",elementUrl:u||""})}}else{var l=r.visibilityTime>=i;if(r.visibilityTimeIntervalId=window.setInterval((function(){if(r.visibilityTime+=100,(l=r.visibilityTime>=i)&&!s){s=!0;var n=o.target.getAttribute("target"),a=o.target.getAttribute("href");t.cb({visibleTime:r.visibilityTime,visibleRatio:e.prepareIntersectionRatio(o.intersectionRatio),elementId:o.target.id,elementClasses:o.target.className,element:o.target,elementTarget:n||"",elementUrl:a||""})}}),100),l&&!s){s=!0;c=o.target.getAttribute("target"),u=o.target.getAttribute("href");t.cb({visibleTime:r.visibilityTime,visibleRatio:e.prepareIntersectionRatio(o.intersectionRatio),elementId:o.target.id,elementClasses:o.target.className,element:o.target,elementTarget:c||"",elementUrl:u||""})}}}else r.clearVisibilityTimeIntervalId()}),n),this.spy(t.selector)}return e.prepareThreshold=function(e){return void 0!==e&&Me("round",e/100,-2),100},e.prepareIntersectionRatio=function(e){return Me("round",100*e,0)},e.prototype.spy=function(e){var t=this,r=document.querySelector(e);r?this.observer.observe(r):this.spyIntervalId=window.setInterval((function(){var r=document.querySelector(e);r&&(t.clearSpyIntervalId(),t.observer.observe(r))}),100)},e.prototype.clearSpyIntervalId=function(){this.spyIntervalId&&(clearInterval(this.spyIntervalId),this.spyIntervalId=null)},e.prototype.clearVisibilityTimeIntervalId=function(){this.visibilityTimeIntervalId&&(clearInterval(this.visibilityTimeIntervalId),this.visibilityTimeIntervalId=null)},e.prototype.resetVisibilityTime=function(){this.visibilityTime=0},e.prototype.deactivate=function(){this.clearSpyIntervalId(),this.clearVisibilityTimeIntervalId(),this.resetVisibilityTime(),this.observer.disconnect()},e}(),je=function(e){this.event=Z("elementVisibility"),this.elementId=e.elementId,this.elementClasses=e.elementClasses,this.element=e.element,this.elementTarget=e.elementTarget,this.elementUrl=e.elementUrl,this.visibleTime=e.visibleTime,this.visibleRatio=e.visibleRatio};Y.elementId,Y.elementClasses,Y.element,Y.elementTarget,Y.elementUrl,Y.visibleRatio,Y.visibleTime;var Ve=function(e){function t(r){var n=e.call(this,r)||this;return n.type=q.DomElementVisible,n.props=r,n.handler=n.handler.bind(n),n.visibilitySensor=new Ne({selector:t.prepareSelector({selector:r.fields.selector,selectorType:r.fields.selectorType}),threshold:r.fields.threshold,visibilityTimeRequired:r.fields.visibilityTimeRequired,cb:n.handler}),n}return r(t,e),t.prepareSelector=function(e){return"id"===e.selectorType?"#".concat(e.selector):e.selector},t.prototype.reset=function(){this.visibilitySensor.deactivate(),this.visibilitySensor=new Ne({selector:t.prepareSelector({selector:this.props.fields.selector,selectorType:this.props.fields.selectorType}),threshold:this.props.fields.threshold,visibilityTimeRequired:this.props.fields.visibilityTimeRequired,cb:this.handler})},t.prototype.handler=function(e){var t=this,r=new je({elementId:e.elementId,elementClasses:e.elementClasses,element:e.element,elementTarget:e.elementTarget,elementUrl:e.elementUrl,visibleTime:e.visibleTime,visibleRatio:e.visibleRatio});return void 0===this.segment||this.segment.check(r)?(this.events.emit("run",{trigger:this,event:r}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:r})}}):{wasRunning:!1}},t}(De);function We(e,t){var r=0;return function(){var n=this,i=arguments;clearTimeout(r),r=window.setTimeout((function(){e.apply(n,i)}),t||100)}}var ze=function(e){this.event=Z("scrollDepth"),this.scrollDirection=e.scrollDirection,this.scrollThreshold=e.scrollThreshold,this.scrollUnits=e.scrollUnits};function Be(e){return e.filter((function(e,t,r){return t===r.findIndex((function(t){return t===e}))}))}Y.scrollDirection,Y.scrollThreshold,Y.scrollUnits;var Ge=function(){function e(){}return e.height=function(){return Math.max(document.body.offsetHeight,document.body.clientHeight,document.body.scrollHeight)},e.width=function(){return Math.max(document.body.offsetWidth,document.body.clientWidth,document.body.scrollWidth)},e}(),Je=function(e){function t(r){var i=e.call(this,r)||this;return i.type=q.ScrollingDepth,i.passedScrollingSteps={vertical:{percents:[],pixels:[]},horizontal:{percents:[],pixels:[]}},i.props=n(n({},r),{fields:t.prepareFields(r.fields)}),i.maxVerticalScrollDepth=0,i.maxHorizontalDepthWidth=0,i.handler=i.handler.bind(i),i.registration=i.registration.bind(i),i.run=i.run.bind(i),i.reset=i.reset.bind(i),i.verticalScrollHandler=i.verticalScrollHandler.bind(i),i.horizontalScrollHandler=i.horizontalScrollHandler.bind(i),i}return r(t,e),t.isScrollingDepthTrigger=function(e){return e.type===q.ScrollingDepth},t.processPercent=function(e){return e.map((function(e){return e<0?0:e>100?100:e}))},t.prepareFields=function(e){var r=n({},e);return r.verticalScrollDepth?J(r.verticalScrollDepth,"percents")?r.verticalScrollDepth.percents=Be(t.processPercent(r.verticalScrollDepth.percents)):J(r.verticalScrollDepth,"pixels")&&(r.verticalScrollDepth.pixels=Be(r.verticalScrollDepth.pixels)):r.horizontalScrollDepth&&(J(r.horizontalScrollDepth,"percents")?r.horizontalScrollDepth.percents=Be(t.processPercent(r.horizontalScrollDepth.percents)):J(r.horizontalScrollDepth,"pixels")&&(r.horizontalScrollDepth.pixels=Be(r.horizontalScrollDepth.pixels))),r},t.prototype.verticalScrollHandler=function(){var e=window.pageYOffset+window.innerHeight;e>this.maxVerticalScrollDepth&&(this.maxVerticalScrollDepth=e,this.run({orientation:"vertical",depth:this.maxVerticalScrollDepth}))},t.prototype.horizontalScrollHandler=function(){var e=window.pageXOffset+window.innerWidth;e>this.maxHorizontalDepthWidth&&(this.maxHorizontalDepthWidth=e,this.run({orientation:"horizontal",depth:this.maxHorizontalDepthWidth}))},t.prototype.registration=function(){this.maxVerticalScrollDepth=0,this.maxHorizontalDepthWidth=0,this.props.fields.verticalScrollDepth&&window.addEventListener("scroll",We(this.verticalScrollHandler,500)),this.props.fields.horizontalScrollDepth&&window.addEventListener("scroll",We(this.horizontalScrollHandler,500)),this.verticalScrollHandler(),this.horizontalScrollHandler()},t.prototype.checkNeededDepth=function(e){var t=this.props.fields.horizontalScrollDepth,r=this.props.fields.verticalScrollDepth,n=[];switch(e.orientation){case"horizontal":if(t)if(J(t,"percents"))for(var i=0;i<t.percents.length;i++){if(!this.passedScrollingSteps.horizontal.percents.includes(t.percents[i]))e.depth/(Ge.width()||1)*100>=t.percents[i]&&(n.push(new ze({scrollDirection:e.orientation,scrollThreshold:t.percents[i],scrollUnits:"percent"})),this.passedScrollingSteps.horizontal.percents.push(t.percents[i]))}else if(J(t,"pixels"))for(i=0;i<t.pixels.length;i++)this.passedScrollingSteps.horizontal.pixels.includes(t.pixels[i])||e.depth>=t.pixels[i]&&(n.push(new ze({scrollDirection:e.orientation,scrollThreshold:t.pixels[i],scrollUnits:"pixel"})),this.passedScrollingSteps.horizontal.pixels.push(t.pixels[i]));break;case"vertical":if(r)if(J(r,"percents"))for(i=0;i<r.percents.length;i++){if(!this.passedScrollingSteps.vertical.percents.includes(r.percents[i]))e.depth/(Ge.height()||1)*100>=r.percents[i]&&(n.push(new ze({scrollDirection:e.orientation,scrollThreshold:r.percents[i],scrollUnits:"percent"})),this.passedScrollingSteps.vertical.percents.push(r.percents[i]))}else if(J(r,"pixels"))for(i=0;i<r.pixels.length;i++)this.passedScrollingSteps.vertical.pixels.includes(r.pixels[i])||e.depth>=r.pixels[i]&&(n.push(new ze({scrollDirection:e.orientation,scrollThreshold:r.pixels[i],scrollUnits:"pixel"})),this.passedScrollingSteps.vertical.pixels.push(r.pixels[i]))}return n},t.prototype.reset=function(){this.maxVerticalScrollDepth=0,this.maxHorizontalDepthWidth=0,this.passedScrollingSteps.horizontal.pixels=[],this.passedScrollingSteps.horizontal.percents=[],this.passedScrollingSteps.vertical.pixels=[],this.passedScrollingSteps.vertical.percents=[]},t.prototype.update=function(){this.verticalScrollHandler(),this.horizontalScrollHandler()},t.prototype.run=function(e){var t=this;this.checkNeededDepth(e).forEach((function(e){t.handler(e)}))},t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),$e=function(e){this.event=Z("formSubmit"),this.formClasses=e.formClasses,this.formElement=e.formElement,this.formId=e.formId,this.formTarget=e.formTarget,this.formText=e.formText,this.formUrl=e.formUrl};Y.formClasses,Y.formElement,Y.formId,Y.formTarget,Y.formText,Y.formUrl;var Ke=function(e){function t(t){var r,n,i=e.call(this,t)||this;return i.type=q.SubmitForm,i.needActivate=!0,i.waitTags=null===(r=t.fields)||void 0===r?void 0:r.waitTags,(null===(n=t.fields)||void 0===n?void 0:n.activateSegment)&&(i.activateSegment=i.segmentFactory.create(t.fields.activateSegment)),i.activateSegment&&(i.needActivate=i.activateSegment.check()),i}return r(t,e),t.isSubmitFormTrigger=function(e){return e.type===q.SubmitForm},t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De);function Ze(e){return void 0===e&&(e=0),new Promise((function(t){setTimeout(t,e)}))}function Ye(e,t){var r=function(){var r;return null===(r=t.apply)||void 0===r?void 0:r.call(t,e,this,arguments)};return r.prototype=Object.getPrototypeOf(e),r}var Qe=function(e){this.event=Z("historyChange"),this.historyChangeSource=e.historyChangeSource,this.newUrl=e.newUrl,this.oldUrl=e.oldUrl,this.newUrlFragment=e.newUrlFragment,this.oldUrlFragment=e.oldUrlFragment};Y.historyChangeSource,Y.newUrl,Y.oldUrl,Y.newUrlFragment,Y.oldUrlFragment;var Xe=function(e){this.event=Z("jsError"),this.errorMessage=e.errorMessage,this.errorUrl=e.errorUrl,this.errorLine=e.errorLine};Y.errorMessage,Y.errorUrl,Y.errorLine;var et=function(e){this.event=Z("timer"),this.timerCurrentTime=e.timerCurrentTime,this.timerElapsedTime=e.timerElapsedTime,this.timerEventNumber=e.timerEventNumber,this.timerInterval=e.timerInterval,this.timerLimit=e.timerLimit,this.timerStartTime=e.timerStartTime,this.timerEventName=e.timerEventName};Y.timerCurrentTime,Y.timerElapsedTime,Y.timerEventNumber,Y.timerInterval,Y.timerLimit,Y.timerStartTime,Y.timerEventName;var tt,rt=function(e){function t(t){var r,n=e.call(this,t)||this;return n.type=q.Timer,n.runCounter=0,n.needActivate=!0,n.props=t,(null===(r=t.fields)||void 0===r?void 0:r.activateSegment)&&(n.activateSegment=n.segmentFactory.create(t.fields.activateSegment)),n.activateSegment&&(n.needActivate=n.activateSegment.check()),n.handler=n.handler.bind(n),n}return r(t,e),t.prototype.countdown=function(){var e=this,t=this.props.fields,r=t.limit,n=t.eventName,i=t.interval,o=Number(new Date);this.intervalID=window.setInterval((function(){if(!r||e.runCounter<=r){var t=Number(new Date);e.runCounter+=1,e.handler(new et({timerEventName:n,timerLimit:r,timerInterval:i,timerCurrentTime:t,timerEventNumber:e.runCounter,timerStartTime:o,timerElapsedTime:t-o}))}else window.clearInterval(e.intervalID)}),i)},t.prototype.start=function(){this.intervalID||this.countdown()},t.prototype.reset=function(){window.clearInterval(this.intervalID)},t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),nt=function(){function e(t){var r=this;this.groupHandler=function(e){return o(r,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:return t=[],[4,this.activateDecorator([e.trigger],(function(){return o(r,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.activateInstructions(e.trigger,t,this.createListenerVisitInstruction(t))];case 1:return r.sent(),J(e.complete,"onRelatedActivitiesCompleted")&&e.complete.onRelatedActivitiesCompleted(),[2,{instructions:t,event:Array.isArray(e.event)?e.event[0]:e.event}]}}))}))}))];case 1:return n.sent(),[2]}}))}))},this.timerHandler=function(e){return o(r,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:return t=[],[4,this.activateDecorator([e.trigger],(function(){return o(r,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.activateInstructions(e.trigger,t,this.createListenerVisitInstruction(t))];case 1:return r.sent(),J(e.complete,"onRelatedActivitiesCompleted")&&e.complete.onRelatedActivitiesCompleted(),[2,{instructions:t,event:Array.isArray(e.event)?e.event[0]:e.event}]}}))}))}))];case 1:return n.sent(),[2]}}))}))},this.clickHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a,c,u,l,h=this;return s(this,(function(f){switch(f.label){case 0:return t=this.register.click,r=[],n=[],i=[],a=null,e.target instanceof Element&&(c=e.target.getAttribute("target"),u=e.target.getAttribute("href"),(l=e.target.textContent)&&(l=l.trim()),a=new qe({elementId:e.target.id,elementClasses:e.target.className,element:e.target,elementTarget:c||"",elementUrl:u||"",elementText:l})),t&&t.forEach((function(e){var t=e.handler(a);t.wasRunning&&(r.push(e),i.push(t.onRelatedActivitiesCompleted))})),a?[4,this.activateDecorator(r,(function(){return o(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return e.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:a}]}}))}))}))]:[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))}))},this.clickLinkHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a,c,u,l,h=this;return s(this,(function(f){switch(f.label){case 0:return t=this.register.click_link,r=[],n=[],i=[],a=null,e.target instanceof Element&&(c=e.target.getAttribute("target"),u=e.target.getAttribute("href"),(l=e.target.textContent)&&(l=l.trim()),a=new qe({elementId:e.target.id,elementClasses:e.target.className,element:e.target,elementTarget:c||"",elementUrl:u||"",elementText:l})),t&&t.forEach((function(e){var t=e.handler(a);t.wasRunning&&(r.push(e),i.push(t.onRelatedActivitiesCompleted))})),a?[4,this.activateDecorator(r,(function(){return o(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return e.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:a}]}}))}))}))]:[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))}))},this.customEventHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a=this;return s(this,(function(c){switch(c.label){case 0:return t=this.register.custom,r=[],n=[],i=[],t&&t.forEach((function(t){var n=t.handler(e);n.wasRunning&&(r.push(t),i.push(n.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return t.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:e}]}}))}))}))];case 1:return c.sent(),[2]}}))}))},this.initializationHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a=this;return s(this,(function(c){switch(c.label){case 0:return t=this.register.initialization,r=[],n=[],i=[],t&&t.forEach((function(t){var n=t.handler(e);n.wasRunning&&(r.push(t),i.push(n.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return t.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:e}]}}))}))}))];case 1:return c.sent(),[2]}}))}))},this.submitFormHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a,c,u,l,h,f=this;return s(this,(function(p){switch(p.label){case 0:return e.preventDefault(),t=null===(h=this.register.submit_form)||void 0===h?void 0:h.filter((function(e){return!!Ke.isSubmitFormTrigger(e)&&e.needActivate})),r=[],n=[],i=[],a=null,e.target instanceof Element&&(c=e.target.getAttribute("target"),u=e.target.getAttribute("href"),(l=e.target.textContent)&&(l=l.trim()),a=new $e({formId:e.target.id,formClasses:e.target.className,formElement:e.target,formTarget:c||"",formUrl:u||"",formText:l})),t&&t.forEach((function(e){var t=e.handler(a);t.wasRunning&&(r.push(e),i.push(t.onRelatedActivitiesCompleted))})),a?[4,this.activateSubmitDecorator(r,(function(){return o(f,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return e.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:a}]}}))}))}))]:[3,2];case 1:p.sent(),e.target instanceof HTMLFormElement&&(this.removeForm(e.target),e.target.submit()),p.label=2;case 2:return[2]}}))}))},this.changeHistoryHandler=function(t,n){return o(r,void 0,void 0,(function(){var r,i,a,c,u,l=this;return s(this,(function(h){switch(h.label){case 0:return r=this.register.change_history,i=[],a=[],c=[],u=e.extractHistoryEvent(t,n),r&&r.forEach((function(e){var t=e.handler(u);t.wasRunning&&(i.push(e),c.push(t.onRelatedActivitiesCompleted))})),u?[4,this.activateDecorator(i,(function(){return o(l,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.activateInstructions(i,a,this.createListenerVisitInstruction(a))];case 1:return e.sent(),c.forEach((function(e){return e()})),[2,{instructions:a,event:u}]}}))}))}))]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}}))}))},this.jsErrorHandler=function(e){return o(r,void 0,void 0,(function(){var t,r,n,i,a,c=this;return s(this,(function(u){switch(u.label){case 0:return t=this.register.js_error,r=[],n=[],i=[],a=new Xe({errorMessage:e.message,errorLine:e.lineno,errorUrl:e.filename}),t&&t.forEach((function(e){var t=e.handler(a);t.wasRunning&&(r.push(e),i.push(t.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(c,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return e.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:a}]}}))}))}))];case 1:return u.sent(),[2]}}))}))},this.register={},this.accumulatorInstruction=[],this.accumulatorForms=[],this.instructionWalker=new B({deps:{instructionStorage:t.instructionStorage}}),this.events=new l,this.privateEvents=new l,this.instructions=t.instructionStorage.content(),this.triggerStorage=t.triggerStorage,this.registerTriggers(t.triggerStorage.categorize())}return e.prototype.createListenerVisitInstruction=function(e){var t=this;return function(r,n){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:switch(r.firingOption){case U.oncePerEvent:return[3,1];case U.noRestrictions:return[3,4];case U.oncePerPage:return[3,6]}return[3,9];case 1:return e.includes(r.strId)?[3,3]:[4,r.run(!n)];case 2:t.sent()&&e.push(r.strId),t.label=3;case 3:return[3,10];case 4:return[4,r.run(!n)];case 5:return t.sent()&&e.push(r.strId),[3,10];case 6:return this.accumulatorInstruction.includes(r.strId)?[3,8]:[4,r.run(!n)];case 7:t.sent()&&this.accumulatorInstruction.push(r.strId),t.label=8;case 8:case 9:return[3,10];case 10:return[2]}}))}))}},e.collectUsingInstructions=function(e,t){var r=[];return t.forEach((function(t){var n;(null===(n=t.triggers)||void 0===n?void 0:n.includes(e))&&r.push(t)})),r},e.collectInstructions=function(t,r){var n=[];return Array.isArray(t)?t.forEach((function(t){n.push.apply(n,c([],a(e.collectUsingInstructions(t.strId,r)),!1))})):n.push.apply(n,c([],a(e.collectUsingInstructions(t.strId,r)),!1)),z.sortInstructionsByPriority(n)},e.prototype.registerTriggers=function(e){var t=this;G(e).forEach((function(r){var n,i,a;switch(t.register[r]=e[r],r){case q.Click:document.addEventListener("click",t.clickHandler);break;case q.ClickLink:document.addEventListener("click",(function(e){e.target instanceof HTMLAnchorElement&&t.clickLinkHandler(e)}));break;case q.GroupTrigger:null===(n=t.register[r])||void 0===n||n.forEach((function(e){e.registerListener("run",(function(e){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.groupHandler(e)];case 1:return t.sent(),[2]}}))}))}))}));break;case q.Custom:t.privateEvents.registerListener("customEvent",t.customEventHandler);break;case q.Initialization:t.privateEvents.registerListener("initialization",(function(){t.initializationHandler(new Ue)}));break;case q.ViewPage:t.privateEvents.registerListener("initialization",(function(){t.viewPageHandler(new Ae)}));break;case q.DomReady:"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){t.domReadyHandler(new Fe)})):t.domReadyHandler(new Fe);break;case q.WindowLoaded:"complete"!==document.readyState?document.addEventListener("load",(function(){t.windowLoadedHandler(new Oe)})):t.windowLoadedHandler(new Oe);break;case q.DomElementVisible:null===(i=t.register[r])||void 0===i||i.forEach((function(e){e.registerListener("run",(function(e){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.domElementVisibilityHandler(e)];case 1:return t.sent(),[2]}}))}))}))}));break;case q.ScrollingDepth:t.registerScrollDepthTriggers();break;case q.SubmitForm:document.addEventListener("click",(function(e){var r=function(e){var t=Boolean(e),r=e instanceof HTMLFormElement,n=e instanceof HTMLInputElement||e instanceof HTMLButtonElement,i=!!n&&("submit"===e.type||"image"===e.type),o=e instanceof HTMLInputElement&&Boolean(e.name||e.value),s=null;if(t)if(n){if((i||o)&&e.form)if(e.form.tagName)s=e.form;else{var a=document.getElementById(e.form.id);a instanceof HTMLFormElement&&(s=a)}}else r&&(s=e);return s}(e.target),n=!1;if(r){for(var i=0;i<t.accumulatorForms.length;i++)if(t.accumulatorForms[i]===r){n=!0;break}n||(t.accumulatorForms.push(r),r.addEventListener("submit",t.submitFormHandler))}}));break;case q.ChangeHistory:window.addEventListener("popstate",(function(e){t.changeHistoryHandler(e,"popstate")})),window.history.pushState=Ye(window.history.pushState,{apply:function(e,r,n){t.changeHistoryHandler({newHistoryState:{data:n[0],unused:n[1],url:n[2]}},"pushState"),e.apply(r,n)}}),window.history.replaceState=Ye(window.history.replaceState,{apply:function(e,r,n){t.changeHistoryHandler({newHistoryState:{data:n[0],unused:n[1],url:n[2]}},"replaceState"),e.apply(r,n)}});break;case q.JSError:window.addEventListener("error",t.jsErrorHandler);break;case q.Timer:null===(a=t.register[r])||void 0===a||a.forEach((function(e){e.registerListener("run",(function(e){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.timerHandler(e)];case 1:return t.sent(),[2]}}))}))})),e instanceof rt&&e.start()}))}}))},e.prototype.registerScrollDepthTriggers=function(){var e,t=this,r=[],n=[],i=[];null===(e=this.register.scrolling_depth)||void 0===e||e.forEach((function(e){if(e.registerListener("run",(function(e){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.scrollDepthHandler(e)];case 1:return t.sent(),[2]}}))}))})),Je.isScrollingDepthTrigger(e))switch(e.props.fields.waitEvent){case q.ViewPage:r.push(e);break;case q.DomReady:n.push(e);break;case q.WindowLoaded:i.push(e)}})),this.privateEvents.registerListener("initialization",(function(){r.forEach((function(e){return e.registration()}))})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){n.forEach((function(e){return e.registration()}))})):n.forEach((function(e){return e.registration()})),"complete"!==document.readyState?document.addEventListener("load",(function(){i.forEach((function(e){return e.registration()}))})):i.forEach((function(e){return e.registration()}))},e.prototype.viewPageHandler=function(e){return o(this,void 0,void 0,(function(){var t,r,n,i,a=this;return s(this,(function(c){switch(c.label){case 0:return t=this.register.view_page,r=[],n=[],i=[],t&&t.forEach((function(t){var n=t.handler(e);n.wasRunning&&(r.push(t),i.push(n.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return t.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:e}]}}))}))}))];case 1:return c.sent(),[2]}}))}))},e.prototype.domReadyHandler=function(e){return o(this,void 0,void 0,(function(){var t,r,n,i,a=this;return s(this,(function(c){switch(c.label){case 0:return t=this.register.dom_ready,r=[],n=[],i=[],t&&t.forEach((function(t){var n=t.handler(e);n.wasRunning&&(r.push(t),i.push(n.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return t.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:e}]}}))}))}))];case 1:return c.sent(),[2]}}))}))},e.prototype.windowLoadedHandler=function(e){return o(this,void 0,void 0,(function(){var t,r,n,i,a=this;return s(this,(function(c){switch(c.label){case 0:return t=this.register.window_loaded,r=[],n=[],i=[],t&&t.forEach((function(t){var n=t.handler(e);n.wasRunning&&(r.push(t),i.push(n.onRelatedActivitiesCompleted))})),[4,this.activateDecorator(r,(function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.activateInstructions(r,n,this.createListenerVisitInstruction(n))];case 1:return t.sent(),i.forEach((function(e){return e()})),[2,{instructions:n,event:e}]}}))}))}))];case 1:return c.sent(),[2]}}))}))},e.prototype.domElementVisibilityHandler=function(e){return o(this,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:return t=[],[4,this.activateDecorator([e.trigger],(function(){return o(r,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.activateInstructions(e.trigger,t,this.createListenerVisitInstruction(t))];case 1:return r.sent(),J(e.complete,"onRelatedActivitiesCompleted")&&e.complete.onRelatedActivitiesCompleted(),[2,{instructions:t,event:Array.isArray(e.event)?e.event[0]:e.event}]}}))}))}))];case 1:return n.sent(),[2]}}))}))},e.prototype.scrollDepthHandler=function(e){return o(this,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:return t=[],[4,this.activateDecorator([e.trigger],(function(){return o(r,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.activateInstructions(e.trigger,t,this.createListenerVisitInstruction(t))];case 1:return r.sent(),J(e.complete,"onRelatedActivitiesCompleted")&&e.complete.onRelatedActivitiesCompleted(),[2,{instructions:t,event:Array.isArray(e.event)?e.event[0]:e.event}]}}))}))}))];case 1:return n.sent(),[2]}}))}))},e.extractHistoryEvent=function(e,t){var r=window.location.origin+window.location.pathname,n="",i="",o=window.location.hash;if(V(e,"newHistoryState")&&e.newHistoryState.url)if(e.newHistoryState.url instanceof URL)n=e.newHistoryState.url.origin+e.newHistoryState.url.pathname,i=e.newHistoryState.url.hash;else{var s=new P(e.newHistoryState.url);n="null"===s.origin?window.location.origin+s.pathname:s.origin+s.pathname,i=s.hash}else e instanceof PopStateEvent&&e.target instanceof Window&&(n=e.target.location.origin+e.target.location.pathname,i=e.target.location.href);return"#"===i[0]&&(i=i.slice(1)),"#"===o[0]&&(o=o.slice(1)),new Qe({historyChangeSource:t,newUrl:n,oldUrl:r,newUrlFragment:i,oldUrlFragment:o})},e.prototype.removeForm=function(e){for(;0<this.accumulatorForms.length;0)if(e===this.accumulatorForms[0]){this.accumulatorForms.splice(0,1),e.removeEventListener("submit",this.submitFormHandler);break}},e.prototype.activateSubmitDecorator=function(e,t){return o(this,void 0,void 0,(function(){function r(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return n.push(e.trigger.strId),[2]}))}))}var n,i,u=this;return s(this,(function(l){return n=[],i=Math.max.apply(Math,c([],a(e.map((function(e){return Ke.isSubmitFormTrigger(e)&&e.waitTags||0}))),!1)),e.forEach((function(e){e.registerListener("complete",r)})),[2,Promise.race([new Promise((function(i){o(u,void 0,void 0,(function(){var o,a,c;return s(this,(function(s){switch(s.label){case 0:return[4,t()];case 1:return o=s.sent(),a=o.instructions,c=o.event,e.forEach((function(e){e.deregisterListener("complete",r)})),c&&this.events.emit("act",{runningTriggers:n,activatedInstructions:a,event:c}),i(),[2]}}))}))})),Ze(i)])]}))}))},e.prototype.activateDecorator=function(e,t){return o(this,void 0,void 0,(function(){function r(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return n.push(e.trigger.strId),[2]}))}))}var n,i,a,c;return s(this,(function(o){switch(o.label){case 0:return n=[],e.forEach((function(e){e.registerListener("complete",r)})),[4,t()];case 1:return i=o.sent(),a=i.instructions,c=i.event,e.forEach((function(e){e.deregisterListener("complete",r)})),c&&this.events.emit("act",{runningTriggers:n,activatedInstructions:a,event:c}),[2]}}))}))},e.prototype.activateInstructions=function(t,r,n){return o(this,void 0,void 0,(function(){var i,o,a;return s(this,(function(s){switch(s.label){case 0:i=e.collectInstructions(t,this.instructions),o=0,s.label=1;case 1:if(!(o<i.length))return[3,11];switch(a=i[o],a.firingOption){case U.oncePerEvent:return[3,2];case U.oncePerPage:return[3,5]}return[3,8];case 2:return r.includes(a.strId)?[3,4]:[4,this.instructionWalker.walk(a,n)];case 3:s.sent(),s.label=4;case 4:return[3,10];case 5:return this.accumulatorInstruction.includes(a.strId)?[3,7]:[4,this.instructionWalker.walk(a,n)];case 6:s.sent(),s.label=7;case 7:return[3,10];case 8:return[4,this.instructionWalker.walk(a,n)];case 9:return s.sent(),[3,10];case 10:return o++,[3,1];case 11:return[2,null]}}))}))},e.prototype.emitEvent=function(e){this.privateEvents.emit("customEvent",e)},e.prototype.initialization=function(){this.privateEvents.emit("initialization")},e.prototype.clean=function(){var e,t,r,n;this.accumulatorInstruction=[],this.accumulatorForms=[],null===(e=this.register[q.GroupTrigger])||void 0===e||e.forEach((function(e){e.type===q.GroupTrigger&&e instanceof He&&e.reset()})),null===(t=this.register[q.DomElementVisible])||void 0===t||t.forEach((function(e){e.type===q.DomElementVisible&&e instanceof Ve&&e.reset()})),null===(r=this.register[q.ScrollingDepth])||void 0===r||r.forEach((function(e){e.type===q.ScrollingDepth&&e instanceof Je&&e.reset()})),null===(n=this.register[q.Timer])||void 0===n||n.forEach((function(e){e.type===q.Timer&&e instanceof rt&&e.reset()}))},e.prototype.update=function(){var e,t;null===(e=this.register[q.ScrollingDepth])||void 0===e||e.forEach((function(e){e.type===q.ScrollingDepth&&e instanceof Je&&e.update()})),null===(t=this.register[q.Timer])||void 0===t||t.forEach((function(e){e.type===q.Timer&&e instanceof rt&&e.start()}))},e}(),it=function(){function e(e){this.deps=e}return e.prototype.create=function(e){return new z(e,this.deps)},e}(),ot=function(){function e(e){var t=this;this.instructions={},this.instructionFactory=new it({tagStorage:e.deps.tagStorage}),e.instructions.forEach((function(e){t.instructions[e.strId]=t.instructionFactory.create(e)}))}return e.prototype.instruction=function(e){return this.instructions[e]},e.prototype.content=function(){var e=this;return G(this.instructions).map((function(t){return e.instructions[t]}))},e}(),st=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.Click,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),at=function(){function e(e){this.type=q.Click,this.deps=e}return e.prototype.create=function(e){return new st({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),ct=function(){function e(e){this.type=q.GroupTrigger,this.deps=e}return e.prototype.create=function(e){var t,r=this,n=[];return null===(t=e.children)||void 0===t||t.forEach((function(e){var t=r.deps.triggersStorage.trigger(e);t&&n.push(t)})),new He({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer},children:n})},e}(),ut=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.Custom,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),lt=function(){function e(e){this.type=q.Custom,this.deps=e}return e.prototype.create=function(e){return new ut({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),ht=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.Initialization,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),ft=function(){function e(e){this.type=q.Initialization,this.deps=e}return e.prototype.create=function(e){return new ht({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),pt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.ViewPage,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),dt=function(){function e(e){this.type=q.ViewPage,this.deps=e}return e.prototype.create=function(e){return new pt({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),mt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.DomReady,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),gt=function(){function e(e){this.type=q.DomReady,this.deps=e}return e.prototype.create=function(e){return new mt({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),vt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.WindowLoaded,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),yt=function(){function e(e){this.type=q.WindowLoaded,this.deps=e}return e.prototype.create=function(e){return new vt({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),wt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.ClickLink,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),bt=function(){function e(e){this.type=q.ClickLink,this.deps=e}return e.prototype.create=function(e){return new wt({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),St=function(){function e(e){this.type=q.DomElementVisible,this.deps=e}return e.prototype.create=function(e){return new Ve({strId:e.strId,segment:e.segment,fields:e.fields,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),Et=function(){function e(e){this.type=q.ScrollingDepth,this.deps=e}return e.prototype.create=function(e){return new Je({strId:e.strId,segment:e.segment,fields:e.fields,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),It=function(){function e(e){this.type=q.SubmitForm,this.deps=e}return e.prototype.create=function(e){return new Ke({strId:e.strId,segment:e.segment,fields:e.fields,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),Ct=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.ChangeHistory,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),Tt=function(){function e(e){this.type=q.ChangeHistory,this.deps=e}return e.prototype.create=function(e){return new Ct({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),Lt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=q.JSError,r.handler=r.handler.bind(r),r}return r(t,e),t.prototype.handler=function(e){var t=this;return void 0===this.segment||this.segment.check(e)?(this.events.emit("run",{trigger:this,event:e}),{wasRunning:!0,onRelatedActivitiesCompleted:function(){t.events.emit("complete",{trigger:t,event:e})}}):{wasRunning:!1}},t}(De),kt=function(){function e(e){this.type=q.JSError,this.deps=e}return e.prototype.create=function(e){return new Lt({strId:e.strId,segment:e.segment,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),Rt=function(){function e(e){this.type=q.Timer,this.deps=e}return e.prototype.create=function(e){return new rt({strId:e.strId,segment:e.segment,fields:e.fields,deps:{variableStorage:this.deps.variableStorage,dataLayer:this.deps.dataLayer}})},e}(),xt=function(){function e(e){var t=this,r=this.sortTriggers(e.triggers),n=e.deps,o=n.variableStorage,s=n.dataLayer;this.triggers={},this.factories={},this.registerFactory(new at({dataLayer:s,variableStorage:o}),new ct({dataLayer:s,variableStorage:o,triggersStorage:this}),new lt({dataLayer:s,variableStorage:o}),new ft({dataLayer:s,variableStorage:o}),new dt({dataLayer:s,variableStorage:o}),new gt({dataLayer:s,variableStorage:o}),new yt({dataLayer:s,variableStorage:o}),new bt({dataLayer:s,variableStorage:o}),new St({dataLayer:s,variableStorage:o}),new Et({dataLayer:s,variableStorage:o}),new It({dataLayer:s,variableStorage:o}),new Tt({dataLayer:s,variableStorage:o}),new kt({dataLayer:s,variableStorage:o}),new Rt({dataLayer:s,variableStorage:o})),r.forEach((function(e){var r=e.type,n=i(e,["type"]);t.triggers[e.strId]=t.factories[r].create(n)}))}return e.prototype.registerFactory=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach((function(t){e.factories[t.type]=t}))},e.prototype.sortTriggers=function(e){var t=c([],a(e),!1);return t.sort((function(e,t){return e.type===q.GroupTrigger?t.children&&t.children.includes(e.strId)?-1:1:-1})),t},e.prototype.trigger=function(e){return this.triggers[e]},e.prototype.categorize=function(){var e=this,t=Object.keys(this.triggers),r={};return t.forEach((function(t){var n=e.triggers[t],i=n.type;if(r[i]){var o=r[i];o&&o.push(n)}else r[i]=[n]})),r},e}();!function(e){e.Html="html",e.Popup="popup",e.Form="form",e.Push="push",e.Pixel="pixel",e.TEST_ASYNC="test_async"}(tt||(tt={}));var _t,Dt=function(e){this.strId=e.strId,this.environment=e.environment};function Pt(e,t,r){var n=document.createRange().createContextualFragment(t);switch(r){case _t.Before:e.before(n);break;case _t.After:e.after(n);break;case _t.LastChild:e.appendChild(n);break;case _t.FirstChild:e.prepend(n);break;default:e.appendChild(n)}}!function(e){e.Before="before",e.After="after",e.FirstChild="first_child",e.LastChild="last_child"}(_t||(_t={}));var Ht=function(e){function t(t){var r=e.call(this,t)||this;return r.type=tt.Html,r.html=t.fields.html,r}return r(t,e),t.prototype.run=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){return Pt(document.body,this.html),[2]}))}))},t}(Dt),qt=function(){function e(e){this.type=tt.Html,this.environment=e}return e.prototype.create=function(e){return new Ht(n(n({},e),{environment:this.environment}))},e}(),Ut=function(e){function t(t){var r=e.call(this,t)||this;return r.type=tt.TEST_ASYNC,r.wait=t.fields.wait,r}return r(t,e),t.prototype.run=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,Ze(this.wait)];case 1:return e.sent(),[2]}}))}))},t}(Dt),At=function(){function e(e){this.type=tt.TEST_ASYNC,this.environment=e}return e.prototype.create=function(e){return new Ut(n(n({},e),{environment:this.environment}))},e}(),Ft="Altcraft Error Response",Ot=function(e){function t(t){var r=this,n=t.error;return(r=e.call(this,Ft)||this).name=Ft,r.error=n,r.error_text=t.error_text,r}return r(t,e),t}(Error),Mt="AC Network Error",Nt=function(e){function t(t){var r=e.call(this,Mt)||this;return r.name=Mt,r.error=t.error,r}return r(t,e),t}(Error);function jt(e){return o(this,void 0,void 0,(function(){var t,r,n,i,o,a,c,u,l;return s(this,(function(s){switch(s.label){case 0:t=e.url,r=void 0===t?"":t,n=e.type,i=void 0===n?"POST":n,o=e.data,a=void 0===o?{}:o,c={mode:"cors",method:i,body:"POST"===i?JSON.stringify(a):void 0},s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(r,c)];case 2:return[4,s.sent().json()];case 3:return J(u=s.sent(),"error")&&u.error>0?[2,Promise.reject(new Ot(u))]:[2,Promise.resolve(u)];case 4:return l=s.sent(),[2,Promise.reject(new Nt({error:l}))];case 5:return[2]}}))}))}var Vt=function(e){this.message=e,this.name="AkApiLibError"};function Wt(e,t){var r=e,n=t;if(r>n)throw new Vt("Execution error generateRandom: min > max.");return r=Math.ceil(r),n=Math.floor(n),Math.floor(Math.random()*(n-r)+r)}var zt,Bt=function(e){function t(t){var r=e.call(this,t)||this;r.type=tt.Popup;var n=t.fields.id;return r.dotJSImport=t.dotJSImport,r.dataRequest=jt({url:"".concat(r.environment.domain,"/popup"),data:{id:n}}),r}return r(t,e),t.renderCss=function(e){return"<style>".concat(e,"</style>")},t.renderJs=function(e){return"<script>\n                (function() {\n                    ".concat(e,"\n                })();\n            <\/script>")},t.renderHtml=function(e,r,n){return'<div id="'.concat(e,'" class="').concat(t.AC_WIDGET_ID,'">\n                ').concat(n,"\n                ").concat(r,"\n            </div>")},t.prototype.run=function(){return o(this,void 0,void 0,(function(){var e,r,n,i,o,c,u,l;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Promise.all([this.dotJSImport,this.dataRequest])];case 1:return e=a.apply(void 0,[s.sent(),2]),r=e[0],(n=e[1]).data&&(i=null==r?void 0:r.default.template(n.data.templates.html),o=null==r?void 0:r.default.template(n.data.templates.css),c=null==r?void 0:r.default.template(n.data.templates.js),u="".concat(t.AC_WIDGET_ID,"-").concat(Wt(1,1e4)),i&&(Pt(document.body,t.renderHtml(u,String(i(n.data.data)),t.renderCss(String(o(n.data.data))))),setTimeout((function(){var e=document.getElementById(u);e&&n.data&&Pt(e,t.renderJs(String(c(n.data.data))))})))),[3,3];case 2:return l=s.sent(),console.error(l),[3,3];case 3:return[2]}}))}))},t.AC_WIDGET_ID="altcraft-popup-widget",t}(Dt),Gt=function(){function e(e,t){this.type=tt.Popup,this.environment=e,this.loader=t}return e.prototype.create=function(e){return new Bt(n(n({},e),{environment:this.environment,dotJSImport:this.loader.dotJSImport}))},e}();!function(e){e.Before="before",e.After="after",e.FirstChild="first_child",e.LastChild="last_child"}(zt||(zt={}));var Jt=function(e){function t(t){var r=e.call(this,t)||this;r.type=tt.Form;var n=t.fields.id;return r.dataRequest=jt({url:"".concat(r.environment.domain,"/get_form"),data:{id:n}}),r}return r(t,e),t.renderEmbedScript=function(e){return'<script id="'.concat(t.EMBED_FORM_SCRIPT_ID,'" src="').concat(e,'"><\/script>')},t.renderIframe=function(e,t){return'<iframe src="'.concat(e,'" frameborder="0" name="ak-form-').concat(t,'" class="ak-form" width="100%" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox"></iframe>')},t.prototype.run=function(){return o(this,void 0,void 0,(function(){var e,r,n,i,o,c;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Promise.all([this.dataRequest])];case 1:return e=a.apply(void 0,[s.sent(),1]),(r=e[0]).data&&(n=r.data.link.split("=")[1],i=document.querySelector(r.data.anchor_point.selector),o=Boolean(document.getElementById(t.EMBED_FORM_SCRIPT_ID)),i&&Pt(i,o?t.renderIframe(r.data.link,n):"".concat(t.renderEmbedScript(r.data.embed_src),"\n                               ").concat(t.renderIframe(r.data.link,n),"\n                               "),r.data.anchor_point.placement)),[3,3];case 2:return c=s.sent(),console.error(c),[3,3];case 3:return[2]}}))}))},t.EMBED_FORM_SCRIPT_ID="altcraft-form-embed",t}(Dt),$t=function(){function e(e){this.type=tt.Form,this.environment=e}return e.prototype.create=function(e){return new Jt(n(n({},e),{environment:this.environment}))},e}(),Kt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=tt.Push,r.swPath=t.fields.swPath,r.resourceToken=t.fields.resourceToken,r.AKPushImport=t.AKPushImport,r.dataRequest=jt({url:"".concat(r.environment.domain,"/push"),data:{resource_token:t.fields.resourceToken,verbose:t.fields.verbose}}),r}return r(t,e),t.prototype.run=function(){return o(this,void 0,void 0,(function(){var e,t,r,i,o;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,Promise.all([this.AKPushImport,this.dataRequest])];case 1:return e=a.apply(void 0,[s.sent(),2]),t=e[0],(r=e[1]).data?(this.swPath&&(r.data=n(n({},r.data),{swPath:this.swPath})),(null==t?void 0:t.default)?(i=null==t?void 0:t.default,[4,new i(n(n({},r.data),{resourceToken:this.resourceToken})).initSubscription()]):[3,3]):[3,3];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:return o=s.sent(),console.error(o),[3,5];case 5:return[2]}}))}))},t}(Dt),Zt=function(){function e(e,t){this.type=tt.Push,this.environment=e,this.loader=t}return e.prototype.create=function(e){return new Kt(n(n({},e),{environment:this.environment,AKPushImport:this.loader.AKPushImport}))},e}(),Yt=function(t){var r=this;t.tagsTypes.forEach((function(n){switch(n){case tt.Popup:r.dotJSImport=(i="".concat(t.environment.domain,"/template.js"),Promise.resolve().then((function(){return e(require(i))})));break;case tt.Push:r.AKPushImport=function(t){return Promise.resolve().then((function(){return e(require(t))}))}("".concat(t.environment.domain,"/AKPush.js"))}var i}))};function Qt(e,t){return o(this,void 0,void 0,(function(){var r,n,i,o,a;return s(this,(function(s){if(r=new P(e,!0),t)for(n=Object.keys(t),i=0;i<n.length;i++)o=n[i],"number"==typeof(a=t[o])?r.query[o]=String(a):Array.isArray(a)?r.query[o]=a.join(","):r.query[o]=a;return[2,new Promise((function(e){var t=function(e){var t=document.createElement("img");return t.width=1,t.height=1,t.src=e,t}(r.toString());t.onload=function(){t.onload=null,t.onerror=null,e()}}))]}))}))}var Xt=function(e){function t(t){var r=e.call(this,t)||this;return r.type=tt.Pixel,r.goals=t.fields.goals,r.value=t.fields.value,r.dataRequest=jt({url:"".concat(r.environment.domain,"/get_pixel"),data:{pixel_id:t.fields.pixel_id}}),r}return r(t,e),t.prototype.run=function(){var e;return o(this,void 0,void 0,(function(){var t,r,n;return s(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,Promise.all([this.dataRequest])];case 1:return t=a.apply(void 0,[i.sent(),1]),(r=t[0]).data?[4,Qt(null===(e=r.data)||void 0===e?void 0:e.link,{goals:this.goals,value:this.value})]:[3,3];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:return n=i.sent(),console.error(n),[3,5];case 5:return[2]}}))}))},t}(Dt),er=function(){function e(e){this.type=tt.Pixel,this.environment=e}return e.prototype.create=function(e){return new Xt(n(n({},e),{environment:this.environment}))},e}(),tr=function(){function e(e,t){var r=this;this.tags={},this.factories={};var n=Be(e.map((function(e){return e.type}))),o=new Yt({environment:t,tagsTypes:n});this.registerFactory(new qt(t),new At(t),new Gt(t,o),new $t(t),new Zt(t,o),new er(t)),e.forEach((function(e){var t=e.type,n=i(e,["type"]);r.tags[e.strId]=r.factories[t].create(n)}))}return e.prototype.registerFactory=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach((function(t){e.factories[t.type]=t}))},e.prototype.tag=function(e){return this.tags[e]},e}(),rr=function(e){this.strId=e.strId,this.environment=e.environment},nr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.DomElement,r.selectorType=t.fields.selectorType,r.selector=t.fields.selector,r.attrName=t.fields.attrName,r}return r(t,e),t.prototype.read=function(){var e,t=null;return(e="id"===this.selectorType?document.getElementById(this.selector):document.querySelector(this.selector))&&(t=e.getAttribute(this.attrName)),t},t}(rr),ir=function(e){this.environment=e},or=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.DomElement,t}return r(t,e),t.prototype.create=function(e){return new nr(n(n({},e),{environment:this.environment}))},t}(ir);var sr,ar={generateRandom:Wt,fromBase64:function(e){try{return function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}(e)}catch(e){return}},toBase64:function(e){try{return function(e){return btoa(encodeURIComponent(e).replace(/%([\dA-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})))}(e)}catch(e){return}},templateStorage:new(function(){function e(){this.storage={}}return e.prototype.getItem=function(e){return this.storage[e]},e.prototype.setItem=function(e,t){this.storage[e]=t},e.prototype.removeItem=function(e){delete this.storage[e]},e.prototype.clear=function(){this.storage={}},e}())};!function(e){e.tag="tag",e.variable="variable"}(sr||(sr={}));var cr=function(){function e(){}return e.convertBody=function(e){return e.replace(/require/g,"akRequire")},e.akRequire=function(e){return ar[e]},e.build=function(t){return new Function("data",e.convertBody(t))},e}();window.akRequire=cr.akRequire;var ur,lr=function(e){function t(r){var n=e.call(this,{strId:r.strId,environment:r.environment})||this;return n.type=t.TYPE,n.body=r.body||"",n.fields=r.fields,n.variable=cr.build(n.body),n}return r(t,e),t.prototype.read=function(){return this.variable(this.fields||{})},t.TYPE="templateVariable",t}(rr),hr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=lr.TYPE,t}return r(t,e),t.prototype.create=function(e){return new lr(n({environment:this.environment},e))},t}(ir),fr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.CustomVariable,r.read=function(){return r.value},r.value=t.value,r}return r(t,e),t}(rr),pr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.CustomVariable,t}return r(t,e),t.prototype.create=function(e){return new fr(e)},t}(ir);!function(e){e.PagePath="PagePath",e.PageHostName="PageHostName",e.PageURL="PageURL",e.Referrer="Referrer",e.DebugMode="DebugMode",e.ContainerID="ContainerID"}(ur||(ur={}));var dr=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.Referrer)}))||this;return r.type=ur.Referrer,r}return r(t,e),t.prototype.read=function(){return document.referrer},t}(rr),mr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.Referrer,t}return r(t,e),t.prototype.create=function(){return new dr({environment:this.environment})},t}(ir);var gr,vr=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.PageURL)}))||this;return r.type=ur.PageURL,r}return r(t,e),t.prototype.read=function(){return window.location.href},t}(rr),yr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.PageURL,t}return r(t,e),t.prototype.create=function(){return new vr({environment:this.environment})},t}(ir),wr=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.PagePath)}))||this;return r.type=ur.PagePath,r}return r(t,e),t.prototype.read=function(){return window.location.pathname},t}(rr),br=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.PagePath,t}return r(t,e),t.prototype.create=function(){return new wr({environment:this.environment})},t}(ir),Sr=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.PageHostName)}))||this;return r.type=ur.PageHostName,r}return r(t,e),t.prototype.read=function(){return window.location.hostname},t}(rr),Er=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.PageHostName,t}return r(t,e),t.prototype.create=function(){return new Sr({environment:this.environment})},t}(ir),Ir=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.DebugMode)}))||this;return r.type=ur.DebugMode,r}return r(t,e),t.prototype.read=function(){return this.environment.isDebug},t}(rr),Cr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.DebugMode,t}return r(t,e),t.prototype.create=function(){return new Ir({environment:this.environment})},t}(ir),Tr=function(e){function t(t){var r=e.call(this,n(n({},t),{strId:Z(ur.ContainerID)}))||this;return r.type=ur.ContainerID,r}return r(t,e),t.prototype.read=function(){return this.environment.containerID},t}(rr),Lr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ur.ContainerID,t}return r(t,e),t.prototype.create=function(){return new Tr({environment:this.environment})},t}(ir);!function(e){e.Full="Full",e.Protocol="Protocol",e.HostName="HostName",e.Port="Port",e.Path="Path",e.FileExtension="FileExtension",e.Request="Request",e.Fragment="Fragment"}(gr||(gr={}));var kr=/^www\./;var Rr,xr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.URL,r.fields=t.fields,r}return r(t,e),t.prototype.read=function(){if(this.fields.type===gr.HostName)return e=this.fields.cleanUp,t=window.location.hostname,e?t.replace(kr,""):t;var e,t,r,n;if(function(e){return e.type===gr.Request}(this.fields))return function(e){for(var t=new P(window.location.href,!0),r=Object.keys(t.query),n=0;n<r.length;n++)if(r[n]===e&&e.length>0)return t.query[r[n]]}(this.fields.key);if(function(e){return e.type===gr.Path}(this.fields))return function(e){for(var t=0;t<e.length;t++){var r=e[t],n=new RegExp("/".concat(r,"$"));if(n.test(window.location.pathname))return window.location.pathname.replace(n,"")}return window.location.pathname}(this.fields.pages);switch(this.fields.type){case gr.Full:return window.location.href;case gr.Protocol:return window.location.protocol.replace(/:$/,"");case gr.Port:return window.location.port;case gr.Fragment:return window.location.hash.replace(/^#/,"");case gr.FileExtension:return r=window.location.pathname,(n=r.split(".").pop())===r?"":n;default:return}},t}(rr),_r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.URL,t}return r(t,e),t.prototype.create=function(e){return new xr(n(n({},e),{environment:this.environment}))},t}(ir);!function(e){e.Full="Full",e.Protocol="Protocol",e.HostName="HostName",e.Port="Port",e.Path="Path",e.FileExtension="FileExtension",e.Request="Request",e.Fragment="Fragment"}(Rr||(Rr={}));var Dr=/^www\./;var Pr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.URLReferrer,r.fields=t.fields,r}return r(t,e),t.prototype.read=function(){if(this.fields.type===Rr.HostName)return e=this.fields.cleanUp,t=new P(document.referrer),e?t.hostname.replace(Dr,""):t.hostname;var e,t;if(function(e){return e.type===Rr.Request}(this.fields))return function(e){for(var t=new P(document.referrer,!0),r=Object.keys(t.query),n=0;n<r.length;n++)if(r[n]===e&&e.length>0)return t.query[r[n]]}(this.fields.key);if(function(e){return e.type===Rr.Path}(this.fields))return function(e){for(var t=new P(document.referrer),r=0;r<e.length;r++){var n=e[r],i=new RegExp("/".concat(n,"$"));if(i.test(t.pathname))return t.pathname.replace(i,"")}return t.pathname}(this.fields.pages);switch(this.fields.type){case Rr.Full:return document.referrer;case Rr.Protocol:return new P(document.referrer).protocol.replace(/:$/,"");case Rr.Port:return new P(document.referrer).port;case Rr.Fragment:return new P(document.referrer).hash.replace(/^#/,"");case Rr.FileExtension:return function(){var e=new P(document.referrer),t=e.pathname.split(".").pop();return t===e.pathname?"":t}();default:return}},t}(rr),Hr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.URLReferrer,t}return r(t,e),t.prototype.create=function(e){return new Pr(n(n({},e),{environment:this.environment}))},t}(ir),qr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.JSVariable,r.fields=t.fields,r}return r(t,e),t.prototype.read=function(){return window[this.fields.variableName]},t}(rr),Ur=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.JSVariable,t}return r(t,e),t.prototype.create=function(e){return new qr(n(n({},e),{environment:this.environment}))},t}(ir),Ar=function(e){function t(t){var r=e.call(this,t)||this;r.type=Q.JSCode;try{r.func=new Function("params","return (".concat(t.fields.code,")()"))}catch(e){r.func=void 0}return r}return r(t,e),t.prototype.read=function(){if("function"==typeof this.func)return this.func()},t}(rr),Fr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.JSCode,t}return r(t,e),t.prototype.create=function(e){return new Ar(n(n({},e),{environment:this.environment}))},t}(ir),Or=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");var r={},n=(t||{}).decode||Vr,i=0;for(;i<e.length;){var o=e.indexOf("=",i);if(-1===o)break;var s=e.indexOf(";",i);if(-1===s)s=e.length;else if(s<o){i=e.lastIndexOf(";",o-1)+1;continue}var a=e.slice(i,o).trim();if(void 0===r[a]){var c=e.slice(o+1,s).trim();34===c.charCodeAt(0)&&(c=c.slice(1,-1)),r[a]=zr(c,n)}i=s+1}return r},Mr=function(e,t,r){var n=r||{},i=n.encode||Wr;if("function"!=typeof i)throw new TypeError("option encode is invalid");if(!jr.test(e))throw new TypeError("argument name is invalid");var o=i(t);if(o&&!jr.test(o))throw new TypeError("argument val is invalid");var s=e+"="+o;if(null!=n.maxAge){var a=n.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(a)}if(n.domain){if(!jr.test(n.domain))throw new TypeError("option domain is invalid");s+="; Domain="+n.domain}if(n.path){if(!jr.test(n.path))throw new TypeError("option path is invalid");s+="; Path="+n.path}if(n.expires){var c=n.expires;if(!function(e){return"[object Date]"===Nr.call(e)||e instanceof Date}(c)||isNaN(c.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+c.toUTCString()}n.httpOnly&&(s+="; HttpOnly");n.secure&&(s+="; Secure");if(n.priority){switch("string"==typeof n.priority?n.priority.toLowerCase():n.priority){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(n.sameSite){switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s},Nr=Object.prototype.toString,jr=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function Vr(e){return-1!==e.indexOf("%")?decodeURIComponent(e):e}function Wr(e){return encodeURIComponent(e)}function zr(e,t){try{return t(e)}catch(t){return e}}var Br={parse:Or,serialize:Mr},Gr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.Cookie,r.cookieName=t.fields.name,r.decodeURI=t.fields.decodeURI,r}return r(t,e),t.prototype.read=function(){return Br.parse(document.cookie,{decode:this.decodeURI?void 0:function(e){return e}})[this.cookieName]},t}(rr),Jr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.Cookie,t}return r(t,e),t.prototype.create=function(e){return new Gr(n(n({},e),{environment:this.environment}))},t}(ir);var $r,Kr,Zr,Yr,Qr=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.ElementVisible,r.selectorType=t.fields.selectorType,r.selector=t.fields.selector,r.resultType=t.fields.resultType,r.threshold="boolean"===t.fields.resultType?t.fields.threshold||1:100,r}return r(t,e),t.prototype.read=function(){var e;if((e="id"===this.selectorType?document.getElementById(this.selector):document.querySelector(this.selector))instanceof HTMLElement){var t=function(e){if(null===e)return 0;var t=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),r=e.getBoundingClientRect().bottom,n=e.getBoundingClientRect().top;return 100*function(){var i=[];if(n<0&&i.push(Math.min(Math.abs(n),e.offsetHeight)),r>t){var o=Math.abs(r-t);i.push(Math.min(o,e.offsetHeight))}var s=i.reduce((function(e,t){return(e||0)+(t||0)}),0);return 0===s?1:s===e.offsetHeight?0:(e.offsetHeight-s)/e.offsetHeight}()}(e);if("boolean"===this.resultType)return t>this.threshold;if("percent"===this.resultType)return t}return"boolean"!==this.resultType&&0},t}(rr),Xr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.ElementVisible,t}return r(t,e),t.prototype.create=function(e){return new Qr(n(n({},e),{environment:this.environment}))},t}(ir),en=function(e){function t(t){var r=e.call(this,t)||this;return r.type=Q.Utm,r.param=t.fields.param,r}return r(t,e),t.prototype.read=function(){var e=new P(window.location.href,!0);switch(this.param){case"content":return e.query.utm_content;case"campaign":return e.query.utm_campaign;case"medium":return e.query.utm_medium;case"source":return e.query.utm_source;case"term":return e.query.utm_term;default:return}},t}(rr),tn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.Utm,t}return r(t,e),t.prototype.create=function(e){return new en(n(n({},e),{environment:this.environment}))},t}(ir),rn=($r=function(e,t){e.exports=function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){if(!a&&p)return p();if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,(function(e){var r=t[s][1][e];return i(r||e)}),u,u.exports,e,t,r,n)}return r[s].exports}for(var o=p,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){var n=e("./init"),i={init:function(e){this.get=n(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};t.exports=i},{"./init":6}],2:[function(e,t,r){var n=e("./terms"),i=e("./helpers/utils"),o={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return o.aliases.main.type+"="+e.type+o.delimiter+o.aliases.main.source+"="+e.source+o.delimiter+o.aliases.main.medium+"="+e.medium+o.delimiter+o.aliases.main.campaign+"="+e.campaign+o.delimiter+o.aliases.main.content+"="+e.content+o.delimiter+o.aliases.main.term+"="+e.term},extra:function(e){return o.aliases.extra.fire_date+"="+i.setDate(new Date,e)+o.delimiter+o.aliases.extra.entrance_point+"="+document.location.href+o.delimiter+o.aliases.extra.referer+"="+(document.referrer||n.none)},user:function(e,t){return o.aliases.udata.visits+"="+e+o.delimiter+o.aliases.udata.ip+"="+t+o.delimiter+o.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return o.aliases.session.pages_seen+"="+e+o.delimiter+o.aliases.session.current_page+"="+document.location.href},promo:function(e){return o.aliases.promo+"="+i.setLeadingZeroToInt(i.randomInt(e.min,e.max),e.max.toString().length)}}};t.exports=o},{"./helpers/utils":5,"./terms":9}],3:[function(e,t,r){var n=e("../data").delimiter;t.exports={encodeData:function(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:function(e,t,r,n,i){var o,s;if(r){var a=new Date;a.setTime(a.getTime()+60*r*1e3),o="; expires="+a.toGMTString()}else o="";s=n&&!i?";domain=."+n:"",document.cookie=this.encodeData(e)+"="+this.encodeData(t)+o+s+"; path=/"},get:function(e){for(var t=this.encodeData(e)+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return this.decodeData(i.substring(t.length,i.length))}return null},destroy:function(e,t,r){this.set(e,"",-1,t,r)},parse:function(e){var t=[],r={};if("string"==typeof e)t.push(e);else for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);for(var o=0;o<t.length;o++){var s;r[this.unsbjs(t[o])]={},s=this.get(t[o])?this.get(t[o]).split(n):[];for(var a=0;a<s.length;a++){var c=s[a].split("="),u=c.splice(0,1);u.push(c.join("=")),r[this.unsbjs(t[o])][u[0]]=this.decodeData(u[1])}}return r},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,t,r){t.exports={parse:function(e){for(var t=this.parseOptions,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,(function(e,r,i){r&&(n[t.q.name][r]=i)})),n},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var t={},r=(e||window.location.search.substring(1)).split("&"),n=0;n<r.length;n++){var i=r[n].split("=");if(void 0===t[i[0]])t[i[0]]=i[1];else if("string"==typeof t[i[0]]){var o=[t[i[0]],i[1]];t[i[0]]=o}else t[i[0]].push(i[1])}return t},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],5:[function(e,t,r){t.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,t){var r=e.getTimezoneOffset()/60,n=e.getHours(),i=t||0===t?t:-r;return e.setHours(n+r+i),e.getFullYear()+"-"+this.setLeadingZeroToInt(e.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(e.getDate(),2)+" "+this.setLeadingZeroToInt(e.getHours(),2)+":"+this.setLeadingZeroToInt(e.getMinutes(),2)+":"+this.setLeadingZeroToInt(e.getSeconds(),2)},setLeadingZeroToInt:function(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r},randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}},{}],6:[function(e,t,r){var n=e("./data"),i=e("./terms"),o=e("./helpers/cookies"),s=e("./helpers/uri"),a=e("./helpers/utils"),c=e("./params"),u=e("./migrations");t.exports=function(e){var t,r,l,h,f,p,d,m,g,v=c.fetch(e),y=s.getParam(),w=v.domain.host,b=v.domain.isolate,S=v.lifetime;function E(){var e;if(void 0!==y.utm_source||void 0!==y.utm_medium||void 0!==y.utm_campaign||void 0!==y.utm_content||void 0!==y.utm_term||void 0!==y.gclid||void 0!==y.yclid||void 0!==y[v.campaign_param])x(),e=I(i.traffic.utm);else if(T(i.traffic.organic))x(),e=I(i.traffic.organic);else if(!o.get(n.containers.session)&&T(i.traffic.referral))x(),e=I(i.traffic.referral);else{if(o.get(n.containers.first)||o.get(n.containers.current))return o.get(n.containers.current);x(),e=I(i.traffic.typein)}return e}function I(e){switch(e){case i.traffic.utm:t=i.traffic.utm,r=void 0!==y.utm_source?y.utm_source:void 0!==y.gclid?"google":void 0!==y.yclid?"yandex":i.none,l=void 0!==y.utm_medium?y.utm_medium:void 0!==y.gclid||void 0!==y.yclid?"cpc":i.none,h=void 0!==y.utm_campaign?y.utm_campaign:void 0!==y[v.campaign_param]?y[v.campaign_param]:void 0!==y.gclid?"google_cpc":void 0!==y.yclid?"yandex_cpc":i.none,f=y.utm_content||i.none,p=C()||i.none;break;case i.traffic.organic:t=i.traffic.organic,r=r||s.getHost(document.referrer),l=i.referer.organic,h=i.none,f=i.none,p=i.none;break;case i.traffic.referral:t=i.traffic.referral,r=r||s.getHost(document.referrer),l=l||i.referer.referral,h=i.none,f=s.parse(document.referrer).path,p=i.none;break;case i.traffic.typein:t=i.traffic.typein,r=v.typein_attributes.source,l=v.typein_attributes.medium,h=i.none,f=i.none,p=i.none;break;default:t=i.oops,r=i.oops,l=i.oops,h=i.oops,f=i.oops,p=i.oops}var o={type:t,source:r,medium:l,campaign:h,content:f,term:p};return n.pack.main(o)}function C(){var e=document.referrer;if(y.utm_term)return y.utm_term;if(!(e&&s.parse(e).host&&s.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return s.getParam(s.parse(document.referrer).query).text}catch(e){return!1}}function T(e){var t=document.referrer;switch(e){case i.traffic.organic:return!!t&&L(t)&&k(t);case i.traffic.referral:return!!t&&L(t)&&R(t);default:return!1}}function L(e){if(v.domain){if(b)return s.getHost(e)!==s.getHost(w);var t=new RegExp("^(?:.*\\.)?"+a.escapeRegexp(w)+"$","i");return!s.getHost(e).match(t)}return s.getHost(e)!==s.getHost(document.location.href)}function k(e){var t="yandex",n="text",i="google",o=new RegExp("^(?:.*\\.)?"+a.escapeRegexp(t)+"\\..{2,9}$"),c=new RegExp(".*"+a.escapeRegexp(n)+"=.*"),u=new RegExp("^(?:www\\.)?"+a.escapeRegexp(i)+"\\..{2,9}$");if(s.parse(e).query&&s.parse(e).host.match(o)&&s.parse(e).query.match(c))return r=t,!0;if(s.parse(e).host.match(u))return r=i,!0;if(!s.parse(e).query)return!1;for(var l=0;l<v.organics.length;l++){if(s.parse(e).host.match(new RegExp("^(?:.*\\.)?"+a.escapeRegexp(v.organics[l].host)+"$","i"))&&s.parse(e).query.match(new RegExp(".*"+a.escapeRegexp(v.organics[l].param)+"=.*","i")))return r=v.organics[l].display||v.organics[l].host,!0;if(l+1===v.organics.length)return!1}}function R(e){if(!(v.referrals.length>0))return r=s.getHost(e),!0;for(var t=0;t<v.referrals.length;t++){if(s.parse(e).host.match(new RegExp("^(?:.*\\.)?"+a.escapeRegexp(v.referrals[t].host)+"$","i")))return r=v.referrals[t].display||v.referrals[t].host,l=v.referrals[t].medium||i.referer.referral,!0;if(t+1===v.referrals.length)return r=s.getHost(e),!0}}function x(){o.set(n.containers.current_extra,n.pack.extra(v.timezone_offset),S,w,b),o.get(n.containers.first_extra)||o.set(n.containers.first_extra,n.pack.extra(v.timezone_offset),S,w,b)}return u.go(S,w,b),o.set(n.containers.current,E(),S,w,b),o.get(n.containers.first)||o.set(n.containers.first,o.get(n.containers.current),S,w,b),o.get(n.containers.udata)?(d=parseInt(o.parse(n.containers.udata)[o.unsbjs(n.containers.udata)][n.aliases.udata.visits])||1,d=o.get(n.containers.session)?d:d+1,m=n.pack.user(d,v.user_ip)):(d=1,m=n.pack.user(d,v.user_ip)),o.set(n.containers.udata,m,S,w,b),o.get(n.containers.session)?(g=parseInt(o.parse(n.containers.session)[o.unsbjs(n.containers.session)][n.aliases.session.pages_seen])||1,g+=1):g=1,o.set(n.containers.session,n.pack.session(g),v.session_length,w,b),v.promocode&&!o.get(n.containers.promocode)&&o.set(n.containers.promocode,n.pack.promo(v.promocode),S,w,b),o.parse(n.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(e,t,r){var n=e("./data"),i=e("./helpers/cookies");t.exports={go:function(e,t,r){var o,s=this.migrations,a={l:e,d:t,i:r};if(i.get(n.containers.first)||i.get(n.service.migrations)){if(!i.get(n.service.migrations))for(o=0;o<s.length;o++)s[o].go(s[o].id,a)}else{var c=[];for(o=0;o<s.length;o++)c.push(s[o].id);var u="";for(o=0;o<c.length;o++)u+=c[o]+"=1",o<c.length-1&&(u+=n.delimiter);i.set(n.service.migrations,u,a.l,a.d,a.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(e,t){var r=e+"=1",o=e+"=0",s=function(e,t,r){return t||r?e:n.delimiter};try{var a=[];for(var c in n.containers)n.containers.hasOwnProperty(c)&&a.push(n.containers[c]);for(var u=0;u<a.length;u++)if(i.get(a[u])){var l=i.get(a[u]).replace(/(\|)?\|(\|)?/g,s);i.destroy(a[u],t.d,t.i),i.destroy(a[u],t.d,!t.i),i.set(a[u],l,t.l,t.d,t.i)}i.get(n.containers.session)&&i.set(n.containers.session,n.pack.session(0),t.l,t.d,t.i),i.set(n.service.migrations,r,t.l,t.d,t.i)}catch(e){i.set(n.service.migrations,o,t.l,t.d,t.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(e,t,r){var n=e("./terms"),i=e("./helpers/uri");t.exports={fetch:function(e){var t=e||{},r={};if(r.lifetime=this.validate.checkFloat(t.lifetime)||6,r.lifetime=parseInt(30*r.lifetime*24*60),r.session_length=this.validate.checkInt(t.session_length)||30,r.timezone_offset=this.validate.checkInt(t.timezone_offset),r.campaign_param=t.campaign_param||!1,r.user_ip=t.user_ip||n.none,t.promocode?(r.promocode={},r.promocode.min=parseInt(t.promocode.min)||1e5,r.promocode.max=parseInt(t.promocode.max)||999999):r.promocode=!1,t.typein_attributes&&t.typein_attributes.source&&t.typein_attributes.medium?(r.typein_attributes={},r.typein_attributes.source=t.typein_attributes.source,r.typein_attributes.medium=t.typein_attributes.medium):r.typein_attributes={source:"(direct)",medium:"(none)"},t.domain&&this.validate.isString(t.domain)?r.domain={host:t.domain,isolate:!1}:t.domain&&t.domain.host?r.domain=t.domain:r.domain={host:i.getHost(document.location.hostname),isolate:!1},r.referrals=[],t.referrals&&t.referrals.length>0)for(var o=0;o<t.referrals.length;o++)t.referrals[o].host&&r.referrals.push(t.referrals[o]);if(r.organics=[],t.organics&&t.organics.length>0)for(var s=0;s<t.organics.length;s++)t.organics[s].host&&t.organics[s].param&&r.organics.push(t.organics[s]);return r.organics.push({host:"bing.com",param:"q",display:"bing"}),r.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),r.organics.push({host:"about.com",param:"q",display:"about"}),r.organics.push({host:"aol.com",param:"q",display:"aol"}),r.organics.push({host:"ask.com",param:"q",display:"ask"}),r.organics.push({host:"globososo.com",param:"q",display:"globo"}),r.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),r.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),r.organics.push({host:"tut.by",param:"query",display:"tut.by"}),r.referrals.push({host:"t.co",display:"twitter.com"}),r.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),r},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(e,t,r){t.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)},$r(Kr={exports:{}},Kr.exports),Kr.exports);!function(e){e.One="one_value",e.None="none_value"}(Zr||(Zr={})),function(e){e.Organic="organic",e.Link="link",e.Ad="ad",e.TypeIn="typein"}(Yr||(Yr={}));var nn=function(e){function t(t){var r=e.call(this,n({},t))||this;return r.type=Q.Source,r.predicate=t.fields.predicate,r.sources=t.fields.check_sources,r.sourcebuster=rn.init(),r}return r(t,e),t.prototype.read=function(){return rn.get.current,"s"},t}(rr),on=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Q.Source,t}return r(t,e),t.prototype.create=function(e){return new nn(n(n({},e),{environment:this.environment}))},t}(ir),sn=function(){function e(e,t){var r=this;this.variables={},this.factories={},this.registerFactory(new or(t),new hr(t),new pr(t),new mr(t),new yr(t),new br(t),new Er(t),new Cr(t),new Lr(t),new _r(t),new Hr(t),new Ur(t),new Fr(t),new Jr(t),new Xr(t),new tn(t),new on(t)),Object.values(ur).forEach((function(e){r.variables[Z(e)]=r.factories[e].create()})),e.forEach((function(e){var t=e.type,n=i(e,["type"]);r.variables[e.strId]=r.factories[t].create(n)}))}return e.prototype.registerFactory=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach((function(t){e.factories[t.type]=t}))},e.prototype.variable=function(e){return this.variables[e]},e.prototype.add=function(e,t,r){this.variables[t]=this.factories[e].create({strId:t,value:r})},e.prototype.readVariables=function(){var e=this,t={};return Object.keys(this.variables).forEach((function(r){var n=e.variables[r].read();"function"!=typeof n&&(t[r]=n)})),t},e.prototype.readBuildIntVariables=function(){var e=this,t={};return Object.keys(this.variables).forEach((function(r){if(r.startsWith(H)){var n=e.variables[r].read();"function"!=typeof n&&(t[r]=n)}})),t},e}();var an=function(){function e(){}return e.formatting=function(t){return e.isActMsg(t)?n(n({},t),{data:n(n({},t.data),{act:n(n({},t.data.act),{event:n(n({},t.data.act.event),{element:t.data.act.event.element instanceof HTMLElement?e.formattingElement(t.data.act.event.element):void 0})})})}):t},e.isActMsg=function(e){return e.type===u.act},e.formattingElement=function(e){return e instanceof HTMLElement?function(e){var t,r,n,i,o="",s=e;for(t=0;s&&1===s.nodeType;s=s.parentNode,t++)r=0===s.childNodes.length?s.innerHTML:"",n=s.tagName.toLowerCase(),i=s.className,o=" "+(""!==s.id?"#"+s.id:i.length>0?n+"."+i.replace(/ /g,"."):n+(r.length>0?":contains('"+r+"')":""))+o;return o.trim()}(e):null},e}(),cn=function(){function e(e){this.logger=e.logger,this.loggerListener=this.loggerListener.bind(this),this.debugCenterListener=this.debugCenterListener.bind(this),this.logger.events.registerListener("msg",this.loggerListener)}return e.isIncomingDebugMsg=function(t){return null!==t&&"object"==typeof t&&V(t,"source")&&t.source===e.DEBUG_MSG_SOURCE&&V(t,"type")&&(t.type===u.disconnect||t.type===u.connect||t.type===u.ping)},e.isOutComingDebugMsg=function(t){return null!==t&&"object"==typeof t&&V(t,"source")&&t.source===e.DEBUG_MSG_SOURCE&&V(t,"type")&&(t.type===u.init||t.type===u.act||t.type===u.ping||t.type===u.disconnect)},e.prototype.loggerListener=function(t){if(window.opener){var r=n(n({},an.formatting(t)),{source:e.DEBUG_MSG_SOURCE});window.opener.postMessage(JSON.stringify(r),"*")}t.type===u.disconnect?window.removeEventListener("message",this.debugCenterListener,!1):t.type===u.init&&window.addEventListener("message",this.debugCenterListener,!1)},e.prototype.debugCenterListener=function(t){try{var r=JSON.parse(t.data);if(e.isIncomingDebugMsg(r)){r.source;var n=i(r,["source"]);this.logger.message(n)}}catch(e){}},e.DEBUG_MSG_SOURCE="ak-debug-center",e}(),un=function(){function e(e){var t,r,n,i=this,o=(r=window.location.href,n=new P(decodeURIComponent(r),!0),Boolean(n.query.actm_debug&&"true"===n.query.actm_debug)),s={isDebug:o,containerID:e.containerID,domain:e.domain};this.tagStorage=new tr(e.tags,s),this.variableStorage=new sn(e.variables,s),this.instructionStorage=new ot({instructions:e.instructions,deps:{tagStorage:this.tagStorage}}),this.dataLayerController=new X({variableStorage:this.variableStorage}),this.triggersStorage=new xt({triggers:e.triggers,deps:{dataLayer:this.dataLayerController,variableStorage:this.variableStorage}}),this.actManager=new nt({instructionStorage:this.instructionStorage,triggerStorage:this.triggersStorage}),this.actManager.events.registerListener("act",(function(e){i.dataLayerController.addInsideItem(e.event)})),this.dataLayerController.events.registerListener("outsideEvent",(function(e){i.actManager.emitEvent(e)})),this.logger=new h({mode:o?"debug":"prod",manager:this.actManager,variableStorage:this.variableStorage}),o&&(this.sender=new cn({logger:this.logger}),this.logger.start()),(t=this.dataLayerController).addOutsideItem.apply(t,c([],a(e.initialDataLayer),!1)),this.reset=this.reset.bind(this),this.spyChangePage(),this.spyChangeHistory(),this.actManager.initialization()}return e.prototype.reset=function(){this.actManager.clean()},e.prototype.spyChangePage=function(){window.addEventListener("beforeunload",this.reset)},e.prototype.spyChangeHistory=function(){var e=this;window.addEventListener("popstate",this.reset),window.history.pushState=Ye(window.history.pushState,{apply:function(t,r,n){e.reset(),t.apply(r,n)}}),window.history.replaceState=Ye(window.history.replaceState,{apply:function(t,r,n){e.reset(),t.apply(r,n)}})},e}();var ln=JSON.parse('{"domain":"https://maksimlavrenyuk.github.io","dataLayerName":"acDataLayer","containerVersion":1,"containerID":"ACTM-1","triggers":[{"strId":"trigger1","type":"click","segment":{"queries":[{"argument":"Variable","filter":"s","operator":"equals"}]}}],"variables":[{"fields":{"predicate":"one_value","check_sources":["organic","link","ad","typein"]},"strId":"Variable","type":"Source"}],"tags":[{"type":"html","fields":{"html":"<div>test</div>"},"strId":"tag1"}],"instructions":[{"strId":"instruction1","firingOption":"once_per_event","priority":0,"tag":"tag1","triggers":["trigger1"]}]}'),hn=window[ln.dataLayerName||"acDataLayer"];new un({tags:ln.tags,variables:ln.variables,instructions:ln.instructions,triggers:ln.triggers,containerID:ln.containerID,initialDataLayer:hn,domain:ln.domain})}();
//# sourceMappingURL=actm.js.map
